STK.register("kit.extra.language",function(a){window.$LANG||(window.$LANG={});return function(b,c){var d=a.core.util.language(b,$LANG);d=d.replace(/\\}/ig,"}");if(c){d=a.templet(d,c)}return d}});STK.register("kit.dom.parseDOM",function(a){return function(c){for(var b in c){if(c[b]&&(c[b].length==1)){c[b]=c[b][0]}}return c}});STK.register("common.listener",function(b){var c={};var a={};a.define=function(e,f){if(c[e]!=null){throw"common.listener.define: 频道已被占用"}c[e]=f;var d={};d.register=function(h,g){if(c[e]==null){throw"common.listener.define: 频道未定义"}b.listener.register(e,h,g)};d.fire=function(g,h){if(c[e]==null){throw"commonlistener.define: 频道未定义"}b.listener.fire(e,g,h)};d.remove=function(h,g){b.listener.remove(e,h,g)};d.cache=function(g){return b.listener.cache(e,g)};return d};return a});STK.register("common.channel.feed",function(b){var a=["publish","forward","voteforward","forward_hide","comment","votecomment","comment_hide","reload"];return b.common.listener.define("common.channel.feed",a)});STK.register("kit.extra.merge",function(a){return function(d,c){var f={};for(var e in d){f[e]=d[e]}for(var e in c){f[e]=c[e]}return f}});STK.register("core.str.trim",function(a){return function(e){if(typeof e!=="string"){throw"trim need a string as parameter"}var b=e.length;var d=0;var c=/(\u3000|\s|\t|\u00A0)/;while(d<b){if(!c.test(e.charAt(d))){break}d+=1}while(b>d){if(!c.test(e.charAt(b-1))){break}b-=1}return e.slice(d,b)}});STK.register("core.json.jsonToQuery",function(a){var b=function(d,c){d=d==null?"":d;d=a.core.str.trim(d.toString());if(c){return encodeURIComponent(d)}else{return d}};return function(g,e){var h=[];if(typeof g=="object"){for(var d in g){if(d==="$nullName"){h=h.concat(g[d]);continue}if(g[d] instanceof Array){for(var f=0,c=g[d].length;f<c;f++){h.push(d+"="+b(g[d][f],e))}}else{if(typeof g[d]!="function"){h.push(d+"="+b(g[d],e))}}}}if(h.length){return h.join("&")}else{return""}}});STK.register("common.log.monitor",function(e){var f=window.location.protocol=="https:"?"https:":"http:";var a=f+"//www.weibojs.com/log/widget.php";var d={refer:document.referrer,title:document.title,ua:window.navigator.userAgent,os:window.navigator.platform+"|"+window.navigator.oscpu};var c=true;var b=function(h){var g=new Image();if(c){g.src=h}else{}g=null};return function(h){var l={};var j=e.kit.extra.merge(d,h);var n=[];for(var g in j){var m=j[g];if(typeof m==="object"){m=e.core.json.jsonToQuery(m)}n.push(g+"="+encodeURIComponent(m))}var i=a+"?"+n.join("&");b(i);l.monitor=b;return l}});STK.register("kit.io.ajax",function(a){return function(i){var h,f,e,g,k,b,c;var j=function(m){a.common.log.monitor({url:document.location.protocol+"//"+document.location.hostname+(h.url.charAt(0)=="/"?h.url:"/"+h.url),param:h.args,method:h.method,result:m&&(m.code||0),httpcode:g.status})};b=function(m){k=false;i.onComplete(m,h.args);setTimeout(l,0)};c=function(m){k=false;i.onFail&&i.onFail(m,h.args);j(m);setTimeout(l,0)};e=[];g=null;k=false;h=a.parseParam({url:"",method:"get",responseType:"json",timeout:30*1000,onTraning:a.funcEmpty,isEncode:true},i);h.onComplete=b;h.onFail=c;var l=function(){if(!e.length){return}if(k===true){return}k=true;h.args=e.shift();g=a.ajax(h)};var d=function(n){while(e.length){e.shift()}k=false;if(g){try{g.abort()}catch(m){}}g=null};f={};f.request=function(m){if(!m){m={}}if(i.noQueue){d()}if(!i.uniqueRequest||!g){e.push(m);m._t=0;l()}};f.abort=d;return f}});STK.register("kit.io.jsonp",function(a){return function(d){var c,f,b,h,e;c=a.parseParam({url:"",method:"get",responseType:"json",varkey:"_v",timeout:30*1000,onComplete:a.funcEmpty,onTraning:a.funcEmpty,onFail:a.funcEmpty,isEncode:true},d);b=[];h={};e=false;var g=function(){if(!b.length){return}if(e===true){return}e=true;h.args=b.shift();h.onComplete=function(i){e=false;c.onComplete(i,h.args);setTimeout(g,0)};h.onFail=function(i){e=false;c.onFail(i);setTimeout(g,0)};a.jsonp(a.kit.extra.merge(c,{args:h.args,onComplete:function(i){h.onComplete(i)},onFail:function(i){try{h.onFail(i)}catch(j){}}}))};f={};f.request=function(i){if(!i){i={}}b.push(i);i._t=1;g()};f.abort=function(i){while(b.length){b.shift()}e=false;h=null};return f}});STK.register("kit.io.inter",function(a){return function(){var b,d,c;b={};d={};c={};b.register=function(f,e){if(d[f]!==undefined){throw f+" interface has been registered"}d[f]=e;c[f]={}};b.hookComplete=function(e,g){var f=a.core.util.getUniqueKey();c[e][f]=g;return f};b.removeHook=function(e,f){if(c[e]&&c[e][f]){delete c[e][f]}};b.getTrans=function(g,e){var f=a.kit.extra.merge(d[g],e);f.onComplete=function(i,l){try{e.onComplete(i,l)}catch(j){}if(i.code==="100000"){try{e.onSuccess(i,l)}catch(j){}}else{try{e.onError(i,l)}catch(j){}}for(var h in c[g]){try{c[g][h](i,l)}catch(j){}}};if(d[g]["requestMode"]==="jsonp"){return a.kit.io.jsonp(f)}else{if(d[g]["requestMode"]==="ijax"){return a.kit.io.ijax(f)}else{return a.kit.io.ajax(f)}}};b.request=function(h,e,g){var f=a.core.json.merge(d[h],e);f.onComplete=function(j,m){try{e.onComplete(j,m)}catch(l){}if(j.code==="100000"){try{e.onSuccess(j,m)}catch(l){}}else{try{if(j.code==="100002"){window.location.href=j.data;return}e.onError(j,m)}catch(l){}}for(var i in c[h]){try{c[h][i](j,m)}catch(l){}}};f=a.core.obj.cut(f,["noqueue"]);f.args=g;if(d[h]["requestMode"]==="jsonp"){return a.jsonp(f)}else{if(d[h]["requestMode"]==="ijax"){return a.ijax(f)}else{return a.ajax(f)}}};return b}});STK.register("common.trans.topic",function(c){var d=(location.host=="widget.weibo.com"||location.host=="dev.weibo.com")?"":"/widget";var a=c.kit.io.inter();var b=a.register;b("addmblog",{url:d+"/public/aj_addMblog.php",method:"post"});b("addfav",{url:d+"/public/aj_addfav.php",method:"post"});b("delfav",{url:d+"/public/aj_delfav.php",method:"post"});b("repost",{url:d+"/public/aj_repost.php",method:"post"});b("comment",{url:d+"/public/aj_comment.php",method:"post"});b("search",{url:d+"/topics/aj_searchmblog.php"});b("search_topic",{url:d+"/topics/aj_searchtopic.php"});b("check",{url:d+"/public/aj_checkstatus.php"});b("person_info",{url:d+"/public/aj_getuserinfo.php"});b("get_forward",{url:d+"/public/aj_getretlist.php"});b("get_comment",{url:d+"/public/aj_commentlist.php"});b("getmblog",{url:d+"/topics/aj_votecontent.php"});b("getcard",{url:d+"/public/aj_namecard.php"});b("getweekrank",{url:d+"/topics/aj_weekrank.php"});b("block",{url:d+"/topics/aj_operateblockid.php",method:"post"});return a});STK.register("common.login.weibologin",function(a){return function(b){b=b||{};var d=b.loginSuccessUrl?"&url="+encodeURIComponent(b.loginSuccessUrl):"";var e=b.lang?"&lang="+b.lang:"";var c="http://weibo.com/a/unlogin/loginmini?_rand="+(+new Date())+e+d;window.open(c,"weibo_login","width=950, height=640, toolbar=yes, menubar=no, resizable=yes, location=no, status=no")}});STK.register("common.topic.login",function(i){var a,k,m,o=location.host;var c=i.kit.extra.language;var b="//service.weibo.com/reg/loginindex.php?appsrc=1lzBEX&backurl=http%3A%2F%2F"+o+"%2Fwidget%2Fpublic%2FloginProxy.html&vsrc=app_cmtbox&showlogo=0",l="//weibo.com/signup/signup.php?vsrc=app_widget_topic_width&backurl=http%3A%2F%2F"+o+"%2Fwidget%2Fpublic%2FloginProxy.html&from=zw&showlogo=0&appsrc=1lzBEX",e="//weibo.com/signup/full_info.php?appsrc=1lzBEX&backurl=http%3A%2F%2Fweibo.com&showlogo=0&vsrc=app_sharepop&diy=&from=zw&regbackurl=http%3A%2F%2F&c=&refer=http%3A%2F%2F";var h=c('<u class="status_icon status_beginner"></u> <a class="user_name" href="http://weibo.com/u/###uid###" target="_blank" title="">###shortname###</a><cite class="WB_vline">|</cite><a class="logout_link" action-type="logout" href="http://weibo.com/logout" onclick="return false;" title="">#L{退出}</a>');var n=c('<u class="status_icon status_beginner"></u> <a class="user_name" action-type="login" href="'+b+'" onclick="return false;" title="">#L{登录}</a><cite class="WB_vline">|</cite><a class="logout_link" action-type="regist" href="'+l+'" onclick="return false;" title="">#L{注册}</a>');var j=c('<u class="status_icon status_beginner"></u> <a class="user_name" href="#" onclick="return false;" title="">###NICK###</a>（#L{您的帐号尚未开通微博}）<a class="WB_btngB" href="'+e+'" onclick="return false;" action-type="fullinfo"><span>#L{立即开通}</span></a><cite class="WB_vline">|</cite><a class="logout_link" action-type="logout" href="http://weibo.com/logout" onclick="return false;" title="">#L{退出}</a>');function g(){if(m==true){return}m=true;var p=i.common.trans.topic.getTrans("person_info",{onComplete:function(r){var q,s;switch(r.code){case"100000":if(r.data&&r.data.name){if(i.bLength(r.data.name)>10){r.data.shortname=i.leftB(r.data.name,8)+"…"}else{r.data.shortname=r.data.name}}if(r.data.icon){s=h.replace(/###(\w+)###/g,function(u,t){return r.data[t]})}else{if(r.data.name){s=j}else{s=n}}s=i.core.util.easyTemplate(s,r.data);break}f.innerHTML=s;m=null},onFail:function(){m=null}});p.request({wsrc:$CONFIG.wsrc||"app_topic_base"})}function d(){var p=i.sizzle('div[class="WB_widget WB_tips_top"]',f);if(p.length>0){var q=setTimeout(function(){i.removeNode(p[0]);clearTimeout(q);q=null},3000)}}var f;return{init:function(q,p){if(q==null){return}f=q;d()},login:function(p,r){var q=location.protocol;i.common.login.weibologin({loginSuccessUrl:q+"//widget.weibo.com/event/jump.html",lang:"zh-cn"})},logout:function(){var p=i.parseURL(location.href);var q=i.queryToJson(p.query);q.loginRnd=+new Date();p=p.scheme+"://"+p.host+"/"+p.path+"?"+i.jsonToQuery(q);location.href="//weibo.com/logout.php?backurl="+encodeURIComponent(p)},regist:function(p,r){window.App=window.App||{};App.loginBackUrlCallBack=function(){if(r){r();g()}else{location.reload()}};var q=l;window.open(q,"regist","width=950,height=620")},fullinfo:function(q){if(typeof $CONFIG!="undefined"&&typeof $CONFIG.is_sina_user!="undefined"&&$CONFIG.is_sina_user=="1"){if(q!=false){var p=e;window.open(p,"fullinfo","width=950,height=620")}return false}return true},close:function(){var p=i.sizzle('div[class="WB_widget WB_tips_top"]',f);if(p.length>0){i.removeNode(p[0])}}}});STK.register("comp.topic.login",function(a){var b=a.kit.extra.language;return function(g,c){var k={};var l,f;var i=a.common.topic.login;var p=function(){m();e();h();j();d();n()};var m=function(){if(g==null||(g!=null&&!a.core.dom.isNode(g))){throw"[comp.topic.login]:argsCheck()-The param node is not a DOM node."}c=a.core.obj.parseParam({html:""},c)};var e=function(){f=a.kit.dom.parseDOM(a.builder(g).list)};var h=function(){i.init(g);l=a.core.evt.delegatedEvent(g);l.add("login","click",i.login);l.add("logout","click",i.logout);l.add("regist","click",i.regist);l.add("fullinfo","click",i.fullinfo);l.add("close","click",i.close)};var j=function(){};var d=function(){};var n=function(){};var o=function(){};p();k.destroy=o;return k}});STK.pageletM.register("pl.topic.login",function(d){var c={};var b=d.E("pl_topic_login");var a=d.comp.topic.login(b,c);return a});STK.register("kit.dom.isTurnoff",function(a){return function(b){return !(b.parentNode&&b.parentNode.nodeType!=11&&!b.disabled)}});STK.register("kit.extra.textareaUtils",function(c){var a={},b=document.selection;a.selectionStart=function(f){if(!b){try{return f.selectionStart}catch(j){return 0}}var k=b.createRange(),i,d,h=0;var g=document.body.createTextRange();g.moveToElementText(f);for(h;g.compareEndPoints("StartToStart",k)<0;h++){g.moveStart("character",1)}return h};a.selectionBefore=function(d){return d.value.slice(0,a.selectionStart(d))};a.selectText=function(d,e,f){d.focus();if(!b){d.setSelectionRange(e,f);return}var g=d.createTextRange();g.collapse(1);g.moveStart("character",e);g.moveEnd("character",f-e);g.select()};a.insertText=function(f,e,h,g){f.focus();g=g||0;if(!b){var i=f.value,k=h-g,d=k+e.length;f.value=i.slice(0,k)+e+i.slice(h,i.length);a.selectText(f,d,d);return}var j=b.createRange();j.moveStart("character",-g);j.text=e};a.replaceText=function(g,e){g.focus();var h=g.value;var k=a.getSelectedText(g);var f=k.length;if(k.length==0){a.insertText(g,e,a.getCursorPos(g))}else{var j=a.getCursorPos(g);if(b){var i=b.createRange();i.text=e;a.setCursor(g,j+e.length)}else{var d=j+k.length;g.value=h.slice(0,j)+e+h.slice(j+f,h.length);a.setCursor(g,j+e.length);return}}};a.getCursorPos=function(g){var f=0;if(STK.core.util.browser.IE){g.focus();var d=null;d=b.createRange();var e=d.duplicate();e.moveToElementText(g);e.setEndPoint("EndToEnd",d);g.selectionStart=e.text.length-d.text.length;g.selectionEnd=g.selectionStart+d.text.length;f=g.selectionStart}else{if(g.selectionStart||g.selectionStart=="0"){f=g.selectionStart}}return f};a.getSelectedText=function(e){var f="";var d=function(g){if(g.selectionStart!=undefined&&g.selectionEnd!=undefined){return g.value.substring(g.selectionStart,g.selectionEnd)}else{return""}};if(window.getSelection){f=d(e)}else{f=b.createRange().text}return f};a.setCursor=function(f,g,e){g=g==null?f.value.length:g;e=e==null?0:e;f.focus();if(f.createTextRange){var d=f.createTextRange();d.move("character",g);d.moveEnd("character",e);d.select()}else{f.setSelectionRange(g,g+e)}};a.unCoverInsertText=function(g,i,f){f=(f==null)?{}:f;f.rcs=f.rcs==null?g.value.length:f.rcs*1;f.rccl=f.rccl==null?0:f.rccl*1;var h=g.value,d=h.slice(0,f.rcs),e=h.slice(f.rcs+f.rccl,h==""?0:h.length);g.value=d+i+e;this.setCursor(g,f.rcs+(i==null?0:i.length))};return a});STK.register("kit.extra.count",function(b){function a(k){var e=41,m=140,c=20,f=k;var l=k.match(/(http|https):\/\/[a-zA-Z0-9]+(\.[a-zA-Z0-9]+)+([-A-Z0-9a-z_\$\.\+\!\*\(\)\/,:;@&=\?\~\#\%]*)*/gi)||[];var d=0;for(var g=0,j=l.length;g<j;g++){var h=b.core.str.bLength(l[g]);if(/^(http:\/\/t.cn)|(https:\/\/t.cn)|(\/\/t.cn)/.test(l[g])){continue}else{if(/^(http:\/\/|https:\/\/|\/\/)+(t.sina.com.cn|t.sina.cn)/.test(l[g])||/^(http:\/\/|https:\/\/|\/\/)+(weibo.com|weibo.cn)/.test(l[g])){d+=h<=e?h:(h<=m?c:(h-m+c))}else{d+=h<=m?c:(h-m+c)}}f=f.replace(l[g],"")}var n=Math.ceil((d+b.core.str.bLength(f))/2);return n}return function(c){c=c.replace(/\r\n/g,"\n");return num=a(c)}});STK.register("module.editor",function(e){var c=e.core.evt.addEvent;var b=e.core.evt.custEvent;var a=e.core.dom.getStyle;var d=e.core.dom.setStyle;return function(u,l){var n={};var l=l;var t={};var k={reset:function(){t.textEl.value="";e.core.evt.custEvent.fire(n,"changed");t.textEl.removeAttribute("extra")},delWords:function(z){var y=k.getWords();if(y.indexOf(z)>-1){t.textEl.value="";w.textInput(y.replace(z,""))}else{return false}},getWords:function(){return e.core.str.trim(t.textEl.value)},getExtra:function(){var z;var y=t.textEl.getAttribute("extra")||"";if(y!=null){z=e.core.str.trim(y)}return z},focus:function(A,y){if(typeof A!="undefined"){e.kit.extra.textareaUtils.setCursor(t.textEl,A,y)}else{var z=t.textEl.value.length;e.kit.extra.textareaUtils.setCursor(t.textEl,z)}f.cacheCurPos()},blur:function(){t.textEl.blur()},addExtraInfo:function(y){if(typeof y=="string"){t.textEl.setAttribute("extra",y)}},disableEditor:function(y){if(y===true){t.textEl.setAttribute("disabled","disabled")}else{t.textEl.removeAttribute("disabled")}},getCurPos:function(){var y=t.textEl.getAttribute("range")||"0&0";return y.split("&")},count:function(){var y=(e.core.str.trim(t.textEl.value).length==0)?e.core.str.trim(t.textEl.value):t.textEl.value;return e.kit.extra.count(y)}};var f={textElFocus:function(){if(t.recommendTopic){e.core.dom.setStyle(t.recommendTopic,"display","none")}e.custEvent.fire(n,"focus");if(t.num){e.core.dom.setStyle(t.num,"display","block")}if(k.getWords()==l.tipText){k.delWords(l.tipText)}},textElBlur:function(){setTimeout(function(){if(t.textEl.value.length===0){if(t.recommendTopic){e.core.dom.setStyle(t.recommendTopic,"display","block")}if(t.num&&t.recommendTopic){e.core.dom.setStyle(t.num,"display","none")}e.custEvent.fire(n,"blur");if(typeof l.tipText!="undefined"){t.textEl.value=l.tipText}}},50)},cacheCurPos:function(){var z=e.kit.extra.textareaUtils.getSelectedText(t.textEl);var A=(z==""||z==null)?0:z.length;var B=e.kit.extra.textareaUtils.getCursorPos(t.textEl);var y=B+"&"+A;t.textEl.setAttribute("range",y)}};var w={textChanged:function(){e.custEvent.fire(n,"keyUpCount")},textInput:function(z,B){var A=k.getCurPos();var B=A[0];var y=A[1];if(k.getWords()==l.tipText&&z!=l.tipText){k.delWords(l.tipText)}e.kit.extra.textareaUtils.unCoverInsertText(t.textEl,z,{rcs:A[0],rccl:A[1]});f.cacheCurPos();e.core.evt.custEvent.fire(n,"changed")}};var q={};var g=function(){s();h()};var v=function(){m();o();p();i()};var i=function(){if(l.storeWords){if(t.textEl.value.length==0){w.textInput(l.storeWords)}return}if(l.tipText){t.textEl.value=l.tipText}};var s=function(){if(!u){throw"node is not defined in module editor"}};var h=function(){var y=e.core.dom.builder(u).list;t=e.kit.dom.parseDOM(y)};var m=function(){e.core.evt.addEvent(t.textEl,"focus",f.textElFocus);e.core.evt.addEvent(t.textEl,"blur",f.textElBlur);e.core.evt.addEvent(t.textEl,"mouseup",f.cacheCurPos);e.core.evt.addEvent(t.textEl,"keyup",f.cacheCurPos)};var j=function(){e.core.evt.custEvent.define(n,"changed")};var o=function(){j();e.core.evt.custEvent.add(n,"changed",w.textChanged)};var p=function(){};var x=function(){};g();var r={reset:k.reset,getWords:k.getWords,getExtra:k.getExtra,delWords:k.delWords,focus:k.focus,blur:k.blur,insertText:w.textInput,check:w.textChanged,addExtraInfo:k.addExtraInfo,disableEditor:k.disableEditor,getCurPos:k.getCurPos,count:k.count};n.destroy=x;n.API=r;n.nodeList=t;n.init=v;n.opts=l;return n}});STK.register("common.editor.plugin.count",function(e){var b;function d(n){var h=41,p=140,f=20,j=n;var o=n.match(/(http:|https:)?\/\/[a-zA-Z0-9]+(\.[a-zA-Z0-9]+)+([-A-Z0-9a-z_\$\.\+\!\*\(\)\/\,\:;@&=\?~#%]*)*/gi)||[];var g=0;for(var k=0,m=o.length;k<m;k++){var l=e.core.str.bLength(o[k]);if(/^(http:\/\/t.cn)|(https:\/\/t.cn)|(\/\/t.cn)/.test(o[k])){continue}else{if(/^(http:\/\/|https:\/\/|\/\/)+(t.sina.com.cn|t.sina.cn)/.test(o[k])||/^(http:\/\/|https:\/\/|\/\/)+(weibo.com|weibo.cn)/.test(o[k])){g+=l<=h?l:(l<=p?f:(l-p+f))}else{g+=l<=p?f:(l-p+f)}}j=j.replace(o[k],"")}var q=Math.ceil((g+e.core.str.bLength(j))/2);return q}function a(i){var h=d(i);var g=Math.abs(b-h);var f;if(h>b||h<1){f={wordsnum:h,vnum:g,overflow:true}}else{if(h==0){f={wordsnum:h,vnum:g,overflow:true}}else{f={wordsnum:h,vnum:g,overflow:false}}}return f}function c(f,g){if(!f.textEl){throw"[editor plugin count]: plz check nodeList"}}return function(i){var f=i.nodeList;var g;var l=i.opts;var k=e.kit.extra.language;b=l.limitNum;c(f);e.custEvent.define(i,"textNum");e.custEvent.define(i,"keyUpCount");var m=f.textEl;var h=f.num;e.addEvent(m,"focus",function(){g=setInterval(function(){j()},200)});e.addEvent(m,"blur",function(){clearInterval(g)});var j=function(){var p=(e.core.str.trim(m.value).length==0)?e.core.str.trim(m.value):m.value;var n=i&&i.opts&&i.opts.extendText;p=p.replace(/\r\n/g,"\n");var o=a(p,l.limitNum);if(p.length>=0&&m.focus){if(o.overflow&&o.wordsnum!=0){h.innerHTML=(n?k(n):"")+k("#L{已经超过}")+'<span class="W_error">'+o.vnum+"</span>字"}else{h.innerHTML=(n?k(n):"")+k("#L{还可以输入}")+"<span>"+o.vnum+"</span>字"}}else{if(p.length===0){h.innerHTML=(n?k(n):"")+k("#L{还可以输入}")+"<span>"+o.vnum+"</span>字"}}e.core.evt.custEvent.fire(i,"textNum",{count:o.wordsnum,isOver:o.overflow})};STK.core.evt.addEvent(m,"keyup",j);e.custEvent.add(i,"keyUpCount",j)}});STK.register("kit.dom.cssText",function(b){var a=function(f,e){var c=(f+";"+e).replace(/(\s*(;)\s*)|(\s*(:)\s*)/g,"$2$4"),d;while(c&&(d=c.match(/(^|;)([\w\-]+:)([^;]*);(.*;)?\2/i))){c=c.replace(d[1]+d[2]+d[3],"")}return c};return function(d){d=d||"";var e=[],c={push:function(g,f){e.push(g+":"+f);return c},remove:function(g){for(var f=0;f<e.length;f++){if(e[f].indexOf(g+":")==0){e.splice(f,1)}}return c},getStyleList:function(){return e.slice()},getCss:function(){return a(d,e.join(";"))}};return c}});STK.register("module.at",function(g){var o=window,j=document,l=g.core.util.browser,b="font-family:Tahoma,宋体;",n=g.kit.extra.textareaUtils.selectionStart;var p;var c,h,e,k;var f=(function(){var d={"<":"&lt;",">":"&gt;",'"':"&quot;","\\":"&#92;","&":"&amp;","'":"&#039;","\r":"","\n":"<br>"," ":(navigator.userAgent.match(/.+(?:ie) ([\d.]+)/i)||[8])[1]<8?['<pre style="overflow:hidden;display:inline;',b,'word-wrap:break-word;"> </pre>'].join(""):['<span style="white-space:pre-wrap;',b,'"> </span>'].join("")};return function(r){var q=r.replace(/(<|>|\"|\\|&|\'|\n|\r| )/g,function(s){return d[s]});return q}})();var a=function(){var d=[],r=p.textEl.style.cssText,q;g.foreach(["margin","padding","border"],function(s){g.foreach(["Top","Left","Bottom","Right"],function(u){var t;if(s!="border"){t=d.push(s,"-",u.toLowerCase(),":",g.getStyle(p.textEl,s+u),";");return}g.foreach(["Color","Style","Width"],function(v){d.push(s,"-",u.toLowerCase(),"-",v.toLowerCase(),":",g.getStyle(p.textEl,[s,u,v].join("")),";")})})});d.push("font-size:"+g.getStyle(p.textEl,"fontSize")+";");return g.kit.dom.cssText([r,d.join(""),b,"word-wrap: break-word;line-height: 18px;overflow-y:auto;overflow-x:hidden;outline:none;"].join("")).getCss()};var m=(function(){var v=g.builder(['<div node-type="wrap" style="display:none;">','<span node-type="before"></span>','<span node-type="flag"></span>','<span node-type="after"></span>',"</div>"].join("")).list;var q=v.wrap[0],w=v.flag[0],d=v.after[0],y=v.before[0],u=0,s,r,x;var t=function(z){if(l.MOZ){return -2}if(l.MOBILE&&l.SAFARI&&(l.IPAD||l.ITOUCH||l.IPHONE)){return -2}return 0};return{bind:function(){if(r===p.textEl){return}k=g.position(p.textEl);var z=["left:",k.l,"px;top:",k.t+20,"px;"].join("");r=p.textEl;var A=a();r.style.cssText=A;x=[z,A,"position:absolute;filter:alpha(opacity=0);opacity:0;z-index:-1000;"].join("");q.style.cssText=x;if(!u){u=1;j.body.appendChild(q)}},content:function(z,B,C,A){q.style.cssText=[x,"width:",((r.offsetWidth||parseInt(g.getStyle(r,"width")))+t()),"px;height:",((r.offsetHeight||parseInt(g.getStyle(r,"height")))),"px;overflow-x:hidden;overflow-y:",(/webkit/i.test(navigator.userAgent))?"hidden":g.getStyle(r,"overflowY"),";"].join("");y.innerHTML=f(z);w.innerHTML=f(B)||"&thinsp;";d.innerHTML=f([C,A].join(""));clearTimeout(s);s=setTimeout(function(){var D=g.position(w);g.custEvent.fire(p.eId,"at",{t:(D.t-r.scrollTop)-k.t+5,l:D.l-k.l+5,key:C,flag:B,textarea:p.textEl})},30)},hide:function(){q.style.display="none"},show:function(){q.style.display=""}}})();var i=function(){if(g.kit.dom.isTurnoff(p.textEl)){clearInterval(c);return}var d=p.textEl.value.replace(/\r/g,"");var t=n(p.textEl);if(t<0||t==e){return}e=t;var r=d.slice(0,t);var q=r.match(new RegExp(["(",p.flag,")([a-zA-Z0-9\u4e00-\u9fa5_]{0,20})$"].join("")));if(!q){g.custEvent.fire(p.eId,"hidden");return}var s=d.slice(t);r=r.slice(0,-q[0].length);m.content(r,q[1],q[2],s)};return function(q){if(!q||!q.textEl){return}q=g.parseParam({textEl:null,flag:"@",eId:g.custEvent.define({},["at","hidden"])},q);var r=function(){if(!p){return}clearInterval(c);g.removeEvent(p.textEl,"blur",r);m.hide()};var d=function(){r();p=q;e=null;m.bind();m.show();c=setInterval(i,200);g.addEvent(q.textEl,"blur",r)};g.addEvent(q.textEl,"focus",d);return q.eId}});STK.register("common.trans.editor",function(c){var d=(location.host=="widget.weibo.com"||location.host=="dev.weibo.com")?"":"/widget";var a=c.kit.io.inter();var b=a.register;b("face",{url:d+"/public/aj_getemotions.php"});b("at",{url:d+"/public/aj_atusers.php"});return a});STK.register("module.suggest",function(j){var h=null,e=j.custEvent,l=e.define,f=e.fire,o=e.add,g=j.addEvent,c=j.removeEvent,m=j.stopEvent;var b=[],a={};var i={ENTER:13,ESC:27,UP:38,DOWN:40,TAB:9};var k=function(w){var v=-1,t=[],r=w.textNode,s=w.uiNode;var A=j.core.evt.delegatedEvent(s);var p=l(r,["open","close","indexChange","onSelect","onIndexChange","onClose","onOpen","openSetFlag"]);p.setFlag=q;var q=function(B){w.flag=B};var y=function(){return j.sizzle(["[action-type=",w.actionType,"]"].join(""),s)};var z=function(){v=-1;c(r,"keydown",u);A.destroy()};var u=function(D){var E,C;if(!(E=D)||!(C=E.keyCode)){return}if(C==i.ENTER){m();f(p,"onSelect",[v,r,w.flag]);return false}if(C==i.UP){m();var B=y().length;v=v<1?B-1:v-1;f(p,"onIndexChange",[v]);return false}if(C==i.DOWN){m();var B=y().length;v=v==(B-1)?0:v+1;f(p,"onIndexChange",[v]);return false}if(C==i.ESC){m();z();f(p,"onClose");return false}if(C==i.TAB){z();f(p,"onClose");return false}};var x=function(B){f(p,"onSelect",[j.core.arr.indexOf(B.el,y()),r,w.flag])};var n=function(B){v=j.core.arr.indexOf(B.el,y());f(p,"onIndexChange",[j.core.arr.indexOf(B.el,y())])};o(p,"open",function(C,B){r=B;z();g(B,"keydown",u);A.add(w.actionType,"mouseover",n);A.add(w.actionType,"click",x);f(p,"onOpen",[w.flag])});o(p,"openSetFlag",function(C,B){q(B)});o(p,"close",function(){z();f(p,"onClose",[w.flag])});o(p,"indexChange",function(B,C){v=C;f(p,"onIndexChange",[v,w.flag])});return p};var d=function(n){var p=n.textNode;var q=j.core.arr.indexOf(p,b);if(!a[q]){b[q=b.length]=p;a[q]=k(n)}return a[q]};return function(n){if(!n.textNode||!n.uiNode){return}n=j.parseParam({textNode:h,uiNode:h,actionType:"item",actionData:"index",flag:""},n);return d(n)}});STK.register("common.channel.at",function(b){var a=["open","close"];return b.common.listener.define("common.channel.at",a)});STK.register("kit.dom.firstChild",function(b){var a=b.core.dom.next;return function(c){var d=c.firstChild;if(d&&d.nodeType!=1){d=a(d)}return d}});STK.register("kit.dom.layoutPos",function(a){return function(e,c,b){if(!a.isNode(c)){throw"kit.dom.layerOutElement need element as first parameter"}if(c===document.body){return false}if(!c.parentNode){return false}if(c.style.display==="none"){return false}var g,f,i,k,h,j,d;g=a.parseParam({pos:"left-bottom",offsetX:0,offsetY:0},b);f=c;if(!f){return false}while(f!==document.body){f=f.parentNode;if(f.style.display==="none"){return false}j=a.getStyle(f,"position");d=f.getAttribute("layout-shell");if(j==="absolute"||j==="fixed"){break}if(d==="true"&&j==="relative"){break}}f.appendChild(e);i=a.position(c,{parent:f});k={w:c.offsetWidth,h:c.offsetHeight};h=g.pos.split("-");if(h[0]==="left"){e.style.left=i.l+g.offsetX+"px"}else{if(h[0]==="right"){e.style.left=i.l+k.w+g.offsetX+"px"}else{if(h[0]==="center"){e.style.left=i.l+k.w/2+g.offsetX+"px"}}}if(h[1]==="top"){e.style.top=i.t+g.offsetY+"px"}else{if(h[1]==="bottom"){e.style.top=i.t+k.h+g.offsetY+"px"}else{if(h[1]==="middle"){e.style.top=i.t+k.h/2+g.offsetY+"px"}}}return true}});STK.register("common.editor.plugin.at",function(e){var y=e.kit.extra.language;var l='<div class="WB_tips_smart WB_email"><p class="tipsmt_title" node-type="suggestTitle">想用@提到谁</p><ul class="tipsmt_list" node-type="suggestWrap"></ul></div>';var f={"@":{normalTitle:y("#L{选择昵称或轻敲空格完成输入}"),moreTitle:y("#L{选择最近@的人或直接输入}"),noTilte:y("#L{轻敲空格完成输入}")},"#":{normal:y("#L{想用什么话题？}")}};var n={"@":'<#et temp data><#list data.data as list><li action-type="item" <#if (list_index == 0)>class="tipsmt_cur" </#if>action-data="value=${list.nickname}" value="${list.nickname}"><a href="#">${list.nickname}<#if (list.remark)>(${list.remark})</#if></a></li><#if (list.count)><span>${list.count}</span></#if></#list></#et>',"#":'<#et temp data><#list data.data as list><li action-type="item" <#if (list_index == 0)>class="cur" </#if>action-data="value=${list.topic}" value="${list.topic}"><a href="#">${list.topic}<#if (list.count)>(${list.count})</#if></a></li></#list></#et>'};var i,k,u,g,c,p,x,j=false,m;var t;var s={"@":"at","#":"topicList"};var d=0;var h=function(){setTimeout(function(){e.custEvent.fire(i,"close")},200)};var a=function(){p.style.display="none"};var o=function(){e.custEvent.add(i,"onIndexChange",function(A,z){q(z)});e.custEvent.add(i,"onSelect",function(z,F,J,H){d=0;e.core.evt.stopEvent();var M=t[F].getAttribute("value");M=M.replace(/\(.*\)/,"");try{J.focus()}catch(G){}var L=e.kit.extra.textareaUtils.selectionStart(J)*1;var A=new RegExp(H+"([a-zA-Z0-9\u4e00-\u9fa5_]{0,20})$");var B=J.value.replace(/\r+/g,"").slice(0,L).match(A);var D=J.value.slice(L,L+1);B=(B&&B[1])?B[1].length:0;var I=e.kit.extra.textareaUtils;if(H=="#"){if(typeof D!="undefined"&&D!=H){M=M+H+" "}}else{M=M+" "}I.insertText(J,M,L,B);var C=I.getCursorPos(J);if(H=="#"&&D==H){I.setCursor(J,C+1);I.insertText(J," ",C+1,0)}C=I.getCursorPos(J);var K=I.getSelectedText(J);var E=(K==""||K==null)?0:K.length;J.setAttribute("range",C+"&"+E);e.custEvent.fire(i,"close")});e.addEvent(u.textEl,"blur",h);e.custEvent.add(i,"onClose",a);e.custEvent.add(i,"onOpen",function(A,z){c.style.display="";p.style.display="";j=true;setTimeout(function(){e.custEvent.fire(i,"indexChange",0)},100)})};var w=function(z,B,C){if(z=="@"){if(B.data&&B.data.length>0){B.title=(C==""?f[z]["moreTitle"]:f[z]["normalTitle"])}else{B.title=f[z]["noTilte"]}}else{B.title=f[z]["normalTitle"]}var A=e.core.util.easyTemplate(n[z],B);return A};var v=function(){e.core.evt.custEvent.add(k,"hidden",function(z,A){e.custEvent.fire(i,"close")});e.core.evt.custEvent.add(k,"at",function(B,C){x=C.key;var z=C.flag;if(x.length==0&&z!="@"){e.custEvent.fire(i,"close");return}var A=document.location.host=="widget.weibo.com"?"":"/widget";e.core.io.ajax({url:A+"/public/aj_atusers.php",args:{wsrc:$CONFIG.wsrc||"app_comment_box",appkey:$CONFIG.source_appkey||$CONFIG.appkey||$CONFIG.app_src,q:x},onComplete:function(E){if(E.code=="100000"){var D=w(z,E,x);e.custEvent.fire(i,"openSetFlag",z);e.custEvent.fire(i,"open",C.textarea);var F=e.core.dom.builder(D);var G=F.box;c.innerHTML=G;c.style.display=(E.data.length==0)?"none":"";g.innerHTML=(x.length==0)?f["@"].moreTitle:f["@"].normalTitle;p.style.cssText=["z-index:11001;background-color:#ffffff;position:absolute;"].join("");e.common.channel.at.fire("open");e.kit.dom.layoutPos(p,C.textarea,{pos:"left-top",offsetX:C.l,offsetY:C.t})}else{e.custEvent.fire(i,"close")}},onFail:function(){e.custEvent.fire(i,"close")}})})};var b=function(){m=u.textEl;k=STK.module.at({textEl:m,flag:"@"})};var r=function(A){d=0;p&&(p.style.display="none");p&&(p.innerHTML="");var z=e.builder(l);p=e.kit.dom.firstChild(z.box);p.style.display="none";document.body.appendChild(p);g=z.list.suggestTitle[0];c=z.list.suggestWrap[0];i&&(e.custEvent.fire(i,"close"));i&&(e.custEvent.remove(i));i=e.module.suggest({textNode:A,uiNode:c,actionType:"item",actionData:"value",flag:"@"});o()};var q=function(z){t=e.sizzle("li",c);t&&t[0]&&e.core.dom.removeClassName(t[d],"tipsmt_cur");e.core.dom.addClassName(t[z],"tipsmt_cur");d=z};return function(A,z){u=A.nodeList;var B={};B.init=function(){b();r(u.textEl);v()};return B}});STK.register("common.editor.base",function(b){var a={limitNum:140};return function(g,c){var h={};var j,i,f,k;j=b.kit.extra.merge(a,c);i=b.module.editor(g,j);f=i.nodeList;k=[];if(typeof c.count=="undefined"||c.count=="enable"){var e=b.common.editor.plugin.count(i,j)}if(j.atSwitch!=null&&j.atSwitch==true){var d=b.common.editor.plugin.at(i,j);d.init()}i.init();i.widget=function(m,n,l){k.push(m);m.init(i,n,l);return i};i.closeWidget=function(){if(k&&k.length!=0){for(var n=0,m=k.length;n<m;n++){k[n].hide()}}};return i}});STK.register("module.layer",function(b){var c=function(e){var d={};if(e.style.display=="none"){e.style.visibility="hidden";e.style.display="";d.w=e.offsetWidth;d.h=e.offsetHeight;e.style.display="none";e.style.visibility="visible"}else{d.w=e.offsetWidth;d.h=e.offsetHeight}return d};var a=function(g,f){f=f||"topleft";var e=null;if(g.style.display=="none"){g.style.visibility="hidden";g.style.display="";e=b.core.dom.position(g);g.style.display="none";g.style.visibility="visible"}else{e=b.core.dom.position(g)}if(f!=="topleft"){var d=c(g);if(f==="topright"){e.l=e.l+d.w}else{if(f==="bottomleft"){e.t=e.t+d.h}else{if(f==="bottomright"){e.l=e.l+d.w;e.t=e.t+d.h}}}}return e};return function(h){var k=b.core.dom.builder(h);var g=k.list.outer[0],e=k.list.inner[0];var j=b.core.dom.uniqueID(g);var i={};var d=b.core.evt.custEvent.define(i,"show");b.core.evt.custEvent.define(d,"hide");var f=null;i.show=function(){g.style.display="";b.core.evt.custEvent.fire(d,"show");return i};i.hide=function(){g.style.display="none";b.custEvent.fire(d,"hide");return i};i.getPosition=function(l){return a(g,l)};i.getSize=function(l){if(l||!f){f=c.apply(i,[g])}return f};i.html=function(l){if(l!==undefined){e.innerHTML=l}return e.innerHTML};i.text=function(l){if(text!==undefined){e.innerHTML=b.core.str.encodeHTML(l)}return b.core.str.decodeHTML(e.innerHTML)};i.appendChild=function(l){e.appendChild(l);return i};i.getUniqueID=function(){return j};i.getOuter=function(){return g};i.getInner=function(){return e};i.getParentNode=function(){return g.parentNode};i.getDomList=function(){return k.list};i.getDomListByKey=function(l){return k.list[l]};i.getDom=function(m,l){if(!k.list[m]){return false}return k.list[m][l||0]};i.getCascadeDom=function(m,l){if(!k.list[m]){return false}return b.core.dom.cascadeNode(k.list[m][l||0])};return i}});STK.register("module.bubble",function(a){return function(h,i){if(!h){throw"module.bubble need template as first parameter"}var f;var g,e,d,k,j,c;g=a.parseParam({width:null,height:null,parent:document.body},i);e=a.module.layer(h);d=e.getDom("outer");k=e.getDom("inner");if(e.getDomListByKey("close")){j=e.getDom("close")}d.style.display="none";c=false;var b=function(m){if(c){return true}var l=a.fixEvent(m);if(!a.contains(d,l.target)){e.hide()}};if(j){a.addEvent(j,"click",e.hide)}a.custEvent.add(e,"show",function(){setTimeout(function(){a.addEvent(document.body,"click",b)},0)});a.custEvent.add(e,"hide",function(){c=false;a.removeEvent(document.body,"click",b)});f=e;f.setPosition=function(l){d.style.top=l.t+"px";d.style.left=l.l+"px";return f};f.setLayout=function(l,m){if(!a.isNode(l)){throw"module.bubble.setDown need element as first parameter"}a.kit.dom.layoutPos(d,l,m);return f};f.setContent=function(l){if(typeof l==="string"){k.innerHTML=l}else{if(a.isNode(l)){k.appendChild(l)}}return f};f.setArrow=function(l){var m;if(e.getDomListByKey("arrow")){m=e.getDom("arrow");m.className=l.className||"";m.style.cssText=l.style||""}};f.clearContent=function(){while(k.children.length){a.removeNode(k.children[0])}};f.stopBoxClose=function(){c=true};f.startBoxClose=function(){c=false};f.destroy=function(){a.removeEvent(document.body,"click",b);e=null;d=null;k=null;j=null};return f}});STK.register("ui.bubble",function(d){var c='<div class="W_layer" node-type="outer"><div class="bg"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td><div class="content"><a class="W_close" href="javascript:void(0);" node-type="close" title="关闭"></a><div node-type="inner"></div></div></td></tr></tbody></table><div class="arrow arrow_t"></div></div></div>';var b=[];var h=function(i){var j=d.module.bubble(c,i);d.custEvent.add(j,"hide",function(){a(j);e(j)});b.push({bub:j,used:true});return j};var e=function(i){i.clearContent();document.body.appendChild(i.getOuter())};var g=function(l){for(var k=0,j=b.length;k<j;k+=1){if(l===b[k]["bub"]){b[k]["used"]=true;return}}};var a=function(l){for(var k=0,j=b.length;k<j;k+=1){if(l===b[k]["bub"]){b[k]["used"]=false;return}}};var f=function(k){var m;for(var l=0,j=b.length;l<j;l+=1){if(!b[l]["used"]){b[l]["used"]=true;m=b[l]["bub"];return m}}m=h(k);return m};return function(i){return f(d.parseParam({},i))}});STK.register("common.bubble.face",function(f){var n='<#et userlist data><div node-type="outer" class="WB_widgets WB_tips_show" style="position:absolute;"><span action-type="close" class="ts_arr"></span><div class="layer_faces"> <a href="#" onclick="return false;" action-type="close" class="WB_tips_show_close" title="关闭">关闭</a> <!-- 内容区 --><div class="tipsshow_detail" node-type="inner"><ul class="faces_list clearfix"><#list data.emotions as item><li action-type="emotion" action-data="text=${item.phrase}"><img src="${item.icon}" alt="${item.phrase}" title="${item.phrase}" /></li></#list></ul></div><!-- /内容区 --> </div></div>';var p='<#et userlist data><div node-type="outer" class="WB_widget WB_widget_layer" style="z-index:9999"><table><tbody><tr><td><div class="layer_shadow"><div class="layer_inner_container"><div class="layer_content"><div class="faces_list_container" node-type="inner"><ul class="faces_list clearfix"><#list data.emotions as item><li class="faces_item" action-type="emotion" action-data="text=${item.phrase}"><img src="${item.icon}" alt="${item.phrase}" title="${item.phrase}" /></li></#list></ul></div></div><a title="" action-type="close" href="javascript:;" class="layer_close_btn layer_close_btn_large"></a></div><div class="layer_inner_arrow layer_inner_arrow_gray" style="left:14px"></div></div><div class="layer_shadow_arrow" style="left:12px"></div></td></tr></tbody></table></div>';var h,e,c,l,g,i,a;var b;i={};f.custEvent.define(i,"insert");f.custEvent.define(i,"hide");var q={close:function(r){f.custEvent.fire(i,"hide")},emotion:function(r){f.custEvent.fire(i,"insert",{value:r.data.text});f.custEvent.fire(i,"hide")}};function m(){l.remove("emotion","click")}var j=function(t){t=t||{};var u=b?p:n;var r=f.core.util.easyTemplate(u);var s=r({emotions:t}).toString();h=f.module.layer(s);j=function(){};k()};var k=function(){l=f.core.evt.delegatedEvent(h.getOuter());l.add("emotion","click",q.emotion);l.add("close","click",q.close);k=function(){}};function o(s){var r=f.common.trans.editor.getTrans("face",{onSuccess:function(t,u){if(parseInt(t.code)==100000&&t.data&&t.data.usual&&t.data.usual.norm){g=t.data.usual.norm;s&&s(g)}}});r.request({wsrc:$CONFIG.wsrc||"app_topic_base",appkey:$CONFIG.appkey||"",type:"face"})}i.getBub=function(){return h};function d(s){s=s||g;j(s);var r=-9,t=3;if(b){r=-10;t=5}f.kit.dom.layoutPos(h.getOuter(),a,{pos:"left-bottom",offsetX:r,offsetY:t});h.show()}return function(s,t){if(!f.isNode(s)){throw"common.bubble.face need el as first parameter!"}a=s;var r=f.parseParam({l:0,latest:false},t);b=r.latest;if(g==null){o(d)}else{d()}return i}});STK.register("common.editor.widget.face",function(a){return function(c){var f={};var e,h,i,d;d=a.parseParam({t:0,l:-15,latest:false},c);var g=function(j,k){e.API.insertText(k.value);h.getBub().hide()};var b=function(){a.core.evt.stopEvent();a.custEvent.remove(h,"insert",g);a.core.evt.preventDefault();h=a.common.bubble.face(e.nodeList[i],d);a.custEvent.add(h,"insert",g);a.custEvent.add(h,"hide",function(){a.custEvent.remove(h,"hide",arguments.callee);a.custEvent.remove(h,"insert",g);f.hide()});a.core.evt.custEvent.fire(f.custKeyShow,"show",["face"])};f.init=function(j,k,l){e=j;i=k;a.addEvent(j.nodeList[i],"click",b)};f.clear=function(){};f.show=function(){};f.hide=function(){if(h&&h.getBub&&h.getBub().hide){h.getBub().hide()}};f.destroy=function(){e=null;a.custEvent.undefine(f)};f.custKeyShow=a.core.evt.custEvent.define(f,"show");return f}});STK.register("kit.extra.reuse",function(a){return function(e,j){var i,h,b;i=a.parseParam({},j);b=[];var f=function(){var k=e();b.push({store:k,used:true});return k};var g=function(k){a.foreach(b,function(m,l){if(k===m.store){m.used=true;return false}})};var d=function(k){a.foreach(b,function(m,l){if(k===m.store){m.used=false;return false}})};var c=function(){for(var l=0,k=b.length;l<k;l+=1){if(b[l]["used"]===false){b[l]["used"]=true;return b[l]["store"]}}return f()};h={};h.setUsed=g;h.setUnused=d;h.getOne=c;h.getLength=function(){return b.length};return h}});STK.register("module.dialog",function(a){return function(n,o){if(!n){throw"module.dialog need template as first parameter"}var k,g,h,f,l,j,q,i,b,c,m,e;b=true;var d=function(){if(b!==false){g.hide()}};var p=function(){k=a.parseParam({t:null,l:null,width:null,height:null},o);g=a.module.layer(n,k);f=g.getOuter();l=g.getDom("title");i=g.getDom("title_content");j=g.getDom("inner");q=g.getDom("close");a.addEvent(q,"click",function(){m()});a.custEvent.add(g,"show",function(){a.hotKey.add(document.documentElement,["esc"],d,{type:"keyup",disableInInput:true})});a.custEvent.add(g,"hide",function(){a.hotKey.remove(document.documentElement,["esc"],d,{type:"keyup"});b=true})};p();e=a.objSup(g,["show","hide"]);m=function(r){if(typeof c==="function"&&!r){if(c()===false){return false}}e.hide();if(a.contains(document.body,g.getOuter())){document.body.removeChild(g.getOuter())}return h};h=g;h.show=function(){if(!a.contains(document.body,g.getOuter())){document.body.appendChild(g.getOuter())}e.show();return h};h.hide=m;h.setPosition=function(r){f.style.top=r.t+"px";f.style.left=r.l+"px";return h};h.setMiddle=function(){var r=a.core.util.winSize();var s=g.getSize(true);f.style.top=a.core.util.scrollPos()["top"]+(r.height-s.h)/2+"px";f.style.left=(r.width-s.w)/2+"px";return h};h.setTitle=function(r){i.innerHTML=r;return h};h.setContent=function(r){if(typeof r==="string"){j.innerHTML=r}else{j.appendChild(r)}return h};h.clearContent=function(){while(j.children.length){a.removeNode(j.children[0])}return h};h.setAlign=function(){};h.setBeforeHideFn=function(r){c=r};h.clearBeforeHideFn=function(){c=null};h.unsupportEsc=function(){b=false};h.supportEsc=function(){b=true};return h}});STK.register("kit.dom.fix",function(d){var a=!(d.core.util.browser.IE6||(document.compatMode!=="CSS1Compat"&&STK.IE)),b=/^(c)|(lt)|(lb)|(rt)|(rb)$/;function c(g){return d.core.dom.getStyle(g,"display")!="none"}function e(h){h=d.core.arr.isArray(h)?h:[0,0];for(var g=0;g<2;g++){if(typeof h[g]!="number"){h[g]=0}}return h}function f(j,r,m){if(!c(j)){return}var q="fixed",t,u,g,p,k=j.offsetWidth,l=j.offsetHeight,n=d.core.util.winSize(),o=0,s=0,h=d.kit.dom.cssText(j.style.cssText);if(!a){q="absolute";var i=d.core.util.scrollPos();o=t=i.top;s=u=i.left;switch(r){case"lt":t+=m[1];u+=m[0];break;case"lb":t+=n.height-l-m[1];u+=m[0];break;case"rt":t+=m[1];u+=n.width-k-m[0];break;case"rb":t+=n.height-l-m[1];u+=n.width-k-m[0];break;case"c":default:t+=(n.height-l)/2+m[1];u+=(n.width-k)/2+m[0]}g=p=""}else{t=p=m[1];u=g=m[0];switch(r){case"lt":p=g="";break;case"lb":t=g="";break;case"rt":u=p="";break;case"rb":t=u="";break;case"c":default:t=(n.height-l)/2+m[1];u=(n.width-k)/2+m[0];p=g=""}}if(r=="c"){if(t<o){t=o}if(u<s){u=s}}h.push("position",q).push("top",t+"px").push("left",u+"px").push("right",g+"px").push("bottom",p+"px");j.style.cssText=h.getCss()}return function(h,n,i){var j,o,k=true,g;if(d.core.dom.isNode(h)&&b.test(n)){var l={getNode:function(){return h},isFixed:function(){return k},setFixed:function(p){(k=!!p)&&f(h,j,o);return this},setAlign:function(p,q){if(b.test(p)){j=p;o=e(q);k&&f(h,j,o)}return this},destroy:function(){if(!a){a&&d.core.evt.removeEvent(window,"scroll",m)}d.core.evt.removeEvent(window,"resize",m);d.core.evt.custEvent.undefine(g)}};g=d.core.evt.custEvent.define(l,"beforeFix");l.setAlign(n,i);function m(p){p=p||window.event;d.core.evt.custEvent.fire(g,"beforeFix",p.type);if(k&&(!a||j=="c")){f(h,j,o)}}if(!a){d.core.evt.addEvent(window,"scroll",m)}d.core.evt.addEvent(window,"resize",m);return l}}});STK.register("module.mask",function(e){var k,c=[],b,j=false,a="STK-Mask-Key";var g=e.core.dom.setStyle,i=e.core.dom.getStyle,h=e.core.evt.custEvent;function d(){k=e.C("div");var m='<div node-type="outer">';if(e.core.util.browser.IE6){m+='<div style="position:absolute;width:100%;height:100%;"></div>'}m+="</div>";k=e.builder(m).list.outer[0];document.body.appendChild(k);j=true;b=e.kit.dom.fix(k,"lt");var n=function(){var o=e.core.util.winSize();k.style.cssText=e.kit.dom.cssText(k.style.cssText).push("width",o.width+"px").push("z-index","99995").push("height",o.height+"px").getCss()};h.add(b,"beforeFix",n);n()}function l(m){var n;if(!(n=m.getAttribute(a))){m.setAttribute(a,n=e.getUniqueKey())}return">"+m.tagName.toLowerCase()+"["+a+'="'+n+'"]'}var f={getNode:function(){return k},show:function(n,m){if(j){n=e.core.obj.parseParam({opacity:0.3,background:"#000000"},n);k.style.background=n.background;g(k,"opacity",n.opacity);k.style.display="";b.setAlign("lt");m&&m()}else{e.Ready(function(){d();f.show(n,m)})}return f},hide:function(){k.style.display="none";nowIndex=undefined;c=[];return f},showUnderNode:function(n,m){if(e.isNode(n)){f.show(m,function(){g(k,"zIndex",i(n,"zIndex"));var p=l(n);var o=e.core.arr.indexOf(c,p);if(o!=-1){c.splice(o,1)}c.push(p);e.core.dom.insertElement(n,k,"beforebegin")})}return f},back:function(){if(c.length<1){return f}var n,m;c.pop();if(c.length<1){f.hide()}else{if((m=c[c.length-1])&&(n=e.sizzle(m,document.body)[0])){g(k,"zIndex",i(n,"zIndex"));e.core.dom.insertElement(n,k,"beforebegin")}else{f.back()}}return f},destroy:function(){h.remove(b);k.style.display="none";lastNode=undefined;_cache={}}};return f});STK.register("kit.dom.drag",function(a){return function(d,p){var h,g,n,l,c,k,e,i;var q=function(){f();j()};var f=function(){h=a.parseParam({moveDom:d,perchStyle:"border:solid #999999 2px;",dragtype:"perch",actObj:{},pagePadding:5},p);n=h.moveDom;g={};l={};c=a.drag(d,{actObj:h.actObj});if(h.dragtype==="perch"){k=a.C("div");e=false;i=false;n=k}d.style.cursor="move"};var j=function(){a.custEvent.add(h.actObj,"dragStart",m);a.custEvent.add(h.actObj,"dragEnd",b);a.custEvent.add(h.actObj,"draging",o)};var m=function(r,u){document.body.style.cursor="move";var t=a.core.util.pageSize()["page"];l=a.core.dom.position(h.moveDom);l.pageX=u.pageX;l.pageY=u.pageY;l.height=h.moveDom.offsetHeight;l.width=h.moveDom.offsetWidth;l.pageHeight=t.height;l.pageWidth=t.width;if(h.dragtype==="perch"){var s=[];s.push(h.perchStyle);s.push("position:absolute");s.push("z-index:"+(h.moveDom.style.zIndex+10));s.push("width:"+h.moveDom.offsetWidth+"px");s.push("height:"+h.moveDom.offsetHeight+"px");s.push("left:"+l.l+"px");s.push("top:"+l.t+"px");k.style.cssText=s.join(";");i=true;setTimeout(function(){if(i){document.body.appendChild(k);e=true}},100)}if(d.setCapture!==undefined){d.setCapture()}};var b=function(r,s){document.body.style.cursor="auto";if(d.setCapture!==undefined){d.releaseCapture()}if(h.dragtype==="perch"){i=false;h.moveDom.style.top=k.style.top;h.moveDom.style.left=k.style.left;if(e){document.body.removeChild(k);e=false}}};var o=function(t,A){var z=l.t+(A.pageY-l.pageY);var s=l.l+(A.pageX-l.pageX);var u=z+l.height;var v=s+l.width;var r=l.pageHeight-h.pagePadding;var w=l.pageWidth-h.pagePadding;if(u<r&&z>0){n.style.top=z+"px"}else{if(z<0){n.style.top="0px"}if(u>=r){n.style.top=r-l.height+"px"}}if(v<w&&s>0){n.style.left=s+"px"}else{if(s<0){n.style.left="0px"}if(v>=w){n.style.left=w-l.width+"px"}}};q();g.destroy=function(){document.body.style.cursor="auto";if(typeof n.setCapture==="function"){n.releaseCapture()}if(h.dragtype==="perch"){i=false;if(e){document.body.removeChild(k);e=false}}a.custEvent.remove(h.actObj,"dragStart",m);a.custEvent.remove(h.actObj,"dragEnd",b);a.custEvent.remove(h.actObj,"draging",o);if(c.destroy){c.destroy()}h=null;n=null;l=null;c=null;k=null;e=null;i=null};g.getActObj=function(){return h.actObj};return g}});STK.register("ui.dialog",function(d){var c='<div class="W_layer" node-type="outer" style="display:none;position:absolute;z-index:10001"><div class="bg"><table border="0" cellspacing="0" cellpadding="0"><tr><td><div class="content"><div class="title" node-type="title"><span node-type="title_content"></span></div><a href="javascript:void(0);" class="W_close" title="#L{关闭}" node-type="close"></a><div node-type="inner"></div></div></td></tr></table></div></div>';var e=d.kit.extra.language;var b=null;var a=function(){var g=d.module.dialog(e(c));d.custEvent.add(g,"show",function(){d.module.mask.showUnderNode(g.getOuter())});d.custEvent.add(g,"hide",function(){d.module.mask.back();g.setMiddle()});d.kit.dom.drag(g.getDom("title"),{actObj:g,moveDom:g.getOuter()});g.destroy=function(){f(g);try{g.hide(true)}catch(h){}};return g};var f=function(g){g.setTitle("").clearContent();b.setUnused(g)};return function(g){var h=d.parseParam({isHold:false},g);var j=h.isHold;h=d.core.obj.cut(h,["isHold"]);if(!b){b=d.kit.extra.reuse(a)}var i=b.getOne();if(!j){d.custEvent.add(i,"hide",function(){d.custEvent.remove(i,"hide",arguments.callee);f(i)})}return i}});STK.register("ui.alert",function(d){var c='<div node-type="outer" class="layer_point"><dl class="point clearfix"><dt><span class="" node-type="icon"></span></dt><dd node-type="inner"><p class="W_texta" node-type="textLarge"></p><p class="W_textb" node-type="textSmall"></p></dd></dl><div class="btn"><a href="javascript:void(0)" class="W_btn_b" node-type="OK"></a></div></div>';var f={success:"icon_succM",error:"icon_errorM",warn:"icon_warnM","delete":"icon_delM",question:"icon_questionM"};var e=d.kit.extra.language;var b=null;var a=function(h,g){h.getDom("icon").className=g.icon;h.getDom("textLarge").innerHTML=g.textLarge;h.getDom("textSmall").innerHTML=g.textSmall;h.getDom("OK").innerHTML="<span>"+g.OKText+"</span>"};return function(l,h){var i,j,k,m,g;i=d.parseParam({title:e("#L{提示}"),icon:"warn",textLarge:l,textSmall:"",OK:d.funcEmpty,OKText:e("#L{确定}"),timeout:0},h);i.icon=f[i.icon];j={};if(!b){b=d.kit.extra.reuse(function(){var n=d.module.layer(e(c));return n})}k=b.getOne();m=d.ui.dialog();m.setContent(k.getOuter());m.setTitle(i.title);a(k,i);d.addEvent(k.getDom("OK"),"click",m.hide);d.custEvent.add(m,"hide",function(){d.custEvent.remove(m,"hide",arguments.callee);d.removeEvent(k.getDom("OK"),"click",m.hide);b.setUnused(k);clearTimeout(g);i.OK()});if(i.timeout){g=setTimeout(m.hide,i.timeout)}m.show().setMiddle();j.alt=k;j.dia=m;return j}});STK.register("kit.extra.crc32",function(a){return function(f,d){function j(l){l=l.replace(/\r\n/g,"\n");var i="";for(var o=0;o<l.length;o++){var m=l.charCodeAt(o);if(m<128){i+=String.fromCharCode(m)}else{if((m>127)&&(m<2048)){i+=String.fromCharCode((m>>6)|192);i+=String.fromCharCode((m&63)|128)}else{i+=String.fromCharCode((m>>12)|224);i+=String.fromCharCode(((m>>6)&63)|128);i+=String.fromCharCode((m&63)|128)}}}return i}f=j(f);var k="00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D";var d;if(typeof(d)=="undefined"){d=0}var h=0;var g=0;d=d^(-1);for(var c=0,b=f.length;c<b;c++){g=(d^f.charCodeAt(c))&255;h="0x"+k.substr(g*9,8);d=(d>>>8)^h}var e=d^(-1);if(e<0){e=4294967296+e}return e}});STK.register("common.extra.imageURL",function(a){return function(i,f){var h={size:"small"};if(typeof i!="string"){return}h=a.core.obj.parseParam(h,f);var e=h.size;function b(j){j=(j+"").replace(/[^a-f0-9]/gi,"");return parseInt(j,16)}var d={ss:{middle:"&690",bmiddle:"&690",small:"&690",thumbnail:"&690",square:"&690",orignal:"&690"},ww:{middle:"bmiddle",large:"large",bmiddle:"bmiddle",small:"small",thumbnail:"thumbnail",square:"square",orignal:"large"}};function g(k,n){var l;if(typeof(n)=="undefined"){n="bmiddle"}if(k.charAt(9)=="w"||k.charAt(9)=="y"){var j=(a.kit.extra.crc32(k)&3)+1;var m=(k.charAt(21)=="g")?"gif":"jpg";l=k.charAt(9)=="w"?"//ww"+j+".sinaimg.cn/"+n+"/"+k+"."+m:"//wx"+j+".sinaimg.cn/"+n+"/"+k+"."+m}else{var j=((k.substr(-2,2),16)&15)+1;l="//ss"+j+".sinaimg.cn/"+n+"/"+k+"&690"}return l}var c=g(i,d.ww[e]);return c}});STK.register("kit.extra.swfobject",function(b){var a=function(){var aq="undefined",aD="object",ab="Shockwave Flash",X="ShockwaveFlash.ShockwaveFlash",aE="application/x-shockwave-flash",ac="SWFObjectExprInst",ax="onreadystatechange",af=window,aL=document,aB=navigator,aa=false,Z=[aN],aG=[],ag=[],al=[],aJ,ad,ap,at,ak=false,aU=false,aH,an,aI=true,ah=function(){var c=typeof aL.getElementById!=aq&&typeof aL.getElementsByTagName!=aq&&typeof aL.createElement!=aq,g=aB.userAgent.toLowerCase(),e=aB.platform.toLowerCase(),j=e?/win/.test(e):/win/.test(g),l=e?/mac/.test(e):/mac/.test(g),i=/webkit/.test(g)?parseFloat(g.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,f=!+"\v1",h=[0,0,0],m=null;if(typeof aB.plugins!=aq&&typeof aB.plugins[ab]==aD){m=aB.plugins[ab].description;if(m&&!(typeof aB.mimeTypes!=aq&&aB.mimeTypes[aE]&&!aB.mimeTypes[aE].enabledPlugin)){aa=true;f=false;m=m.replace(/^.*\s+(\S+\s+\S+$)/,"$1");h[0]=parseInt(m.replace(/^(.*)\..*$/,"$1"),10);h[1]=parseInt(m.replace(/^.*\.(.*)\s.*$/,"$1"),10);h[2]=/[a-zA-Z]/.test(m)?parseInt(m.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof af.ActiveXObject!=aq){try{var k=new ActiveXObject(X);if(k){m=k.GetVariable("$version");if(m){f=true;m=m.split(" ")[1].split(",");h=[parseInt(m[0],10),parseInt(m[1],10),parseInt(m[2],10)]}}}catch(d){}}}return{w3:c,pv:h,wk:i,ie:f,win:j,mac:l}}(),aK=function(){if(!ah.w3){return}if((typeof aL.readyState!=aq&&aL.readyState=="complete")||(typeof aL.readyState==aq&&(aL.getElementsByTagName("body")[0]||aL.body))){aP()}if(!ak){if(typeof aL.addEventListener!=aq){aL.addEventListener("DOMContentLoaded",aP,false)}if(ah.ie&&ah.win){aL.attachEvent(ax,function(){if(aL.readyState=="complete"){aL.detachEvent(ax,arguments.callee);aP()}});if(af==top){(function(){if(ak){return}try{aL.documentElement.doScroll("left")}catch(c){setTimeout(arguments.callee,0);return}aP()})()}}if(ah.wk){(function(){if(ak){return}if(!/loaded|complete/.test(aL.readyState)){setTimeout(arguments.callee,0);return}aP()})()}aC(aP)}}();function aP(){if(ak){return}try{var d=aL.getElementsByTagName("body")[0].appendChild(ar("span"));d.parentNode.removeChild(d)}catch(c){return}ak=true;var f=Z.length;for(var e=0;e<f;e++){Z[e]()}}function aj(c){if(ak){c()}else{Z[Z.length]=c}}function aC(c){if(typeof af.addEventListener!=aq){af.addEventListener("load",c,false)}else{if(typeof aL.addEventListener!=aq){aL.addEventListener("load",c,false)}else{if(typeof af.attachEvent!=aq){aM(af,"onload",c)}else{if(typeof af.onload=="function"){var d=af.onload;af.onload=function(){d();c()}}else{af.onload=c}}}}}function aN(){if(aa){Y()}else{am()}}function Y(){var f=aL.getElementsByTagName("body")[0];var d=ar(aD);d.setAttribute("type",aE);var c=f.appendChild(d);if(c){var e=0;(function(){if(typeof c.GetVariable!=aq){var g=c.GetVariable("$version");if(g){g=g.split(" ")[1].split(",");ah.pv=[parseInt(g[0],10),parseInt(g[1],10),parseInt(g[2],10)]}}else{if(e<10){e++;setTimeout(arguments.callee,10);return}}f.removeChild(d);c=null;am()})()}else{am()}}function am(){var i=aG.length;if(i>0){for(var j=0;j<i;j++){var e=aG[j].id;var n=aG[j].callbackFn;var c={success:false,id:e};if(ah.pv[0]>0){var k=aS(e);if(k){if(ao(aG[j].swfVersion)&&!(ah.wk&&ah.wk<312)){ay(e,true);if(n){c.success=true;c.ref=av(e);n(c)}}else{if(aG[j].expressInstall&&au()){var g={};g.data=aG[j].expressInstall;g.width=k.getAttribute("width")||"0";g.height=k.getAttribute("height")||"0";if(k.getAttribute("class")){g.styleclass=k.getAttribute("class")}if(k.getAttribute("align")){g.align=k.getAttribute("align")}var h={};var f=k.getElementsByTagName("param");var m=f.length;for(var l=0;l<m;l++){if(f[l].getAttribute("name").toLowerCase()!="movie"){h[f[l].getAttribute("name")]=f[l].getAttribute("value")}}ae(g,h,e,n)}else{aF(k);if(n){n(c)}}}}}else{ay(e,true);if(n){var d=av(e);if(d&&typeof d.SetVariable!=aq){c.success=true;c.ref=d}n(c)}}}}}function av(d){var f=null;var e=aS(d);if(e&&e.nodeName=="OBJECT"){if(typeof e.SetVariable!=aq){f=e}else{var c=e.getElementsByTagName(aD)[0];if(c){f=c}}}return f}function au(){return !aU&&ao("6.0.65")&&(ah.win||ah.mac)&&!(ah.wk&&ah.wk<312)}function ae(h,f,j,g){aU=true;ap=g||null;at={success:false,id:j};var c=aS(j);if(c){if(c.nodeName=="OBJECT"){aJ=aO(c);ad=null}else{aJ=c;ad=j}h.id=ac;if(typeof h.width==aq||(!/%$/.test(h.width)&&parseInt(h.width,10)<310)){h.width="310"}if(typeof h.height==aq||(!/%$/.test(h.height)&&parseInt(h.height,10)<137)){h.height="137"}aL.title=aL.title.slice(0,47)+" - Flash Player Installation";var d=ah.ie&&ah.win?"ActiveX":"PlugIn",e="MMredirectURL="+af.location.toString().replace(/&/g,"%26")+"&MMplayerType="+d+"&MMdoctitle="+aL.title;if(typeof f.flashvars!=aq){f.flashvars+="&"+e}else{f.flashvars=e}if(ah.ie&&ah.win&&c.readyState!=4){var i=ar("div");j+="SWFObjectNew";i.setAttribute("id",j);c.parentNode.insertBefore(i,c);c.style.display="none";(function(){if(c.readyState==4){c.parentNode.removeChild(c)}else{setTimeout(arguments.callee,10)}})()}aA(h,f,j)}}function aF(c){if(ah.ie&&ah.win&&c.readyState!=4){var d=ar("div");c.parentNode.insertBefore(d,c);d.parentNode.replaceChild(aO(c),d);c.style.display="none";(function(){if(c.readyState==4){c.parentNode.removeChild(c)}else{setTimeout(arguments.callee,10)}})()}else{c.parentNode.replaceChild(aO(c),c)}}function aO(d){var f=ar("div");if(ah.win&&ah.ie){f.innerHTML=d.innerHTML}else{var g=d.getElementsByTagName(aD)[0];if(g){var c=g.childNodes;if(c){var h=c.length;for(var e=0;e<h;e++){if(!(c[e].nodeType==1&&c[e].nodeName=="PARAM")&&!(c[e].nodeType==8)){f.appendChild(c[e].cloneNode(true))}}}}}return f}function aA(g,i,e){var f,c=aS(e);if(ah.wk&&ah.wk<312){return f}if(c){if(typeof g.id==aq){g.id=e}if(ah.ie&&ah.win){var h="";for(var k in g){if(g[k]!=Object.prototype[k]){if(k.toLowerCase()=="data"){i.movie=g[k]}else{if(k.toLowerCase()=="styleclass"){h+=' class="'+g[k]+'"'}else{if(k.toLowerCase()!="classid"){h+=" "+k+'="'+g[k]+'"'}}}}}var j="";for(var l in i){if(i[l]!=Object.prototype[l]){j+='<param name="'+l+'" value="'+i[l]+'" />'}}c.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+h+">"+j+"</object>";ag[ag.length]=g.id;f=aS(g.id)}else{var d=ar(aD);d.setAttribute("type",aE);for(var m in g){if(g[m]!=Object.prototype[m]){if(m.toLowerCase()=="styleclass"){d.setAttribute("class",g[m])}else{if(m.toLowerCase()!="classid"){d.setAttribute(m,g[m])}}}}for(var n in i){if(i[n]!=Object.prototype[n]&&n.toLowerCase()!="movie"){aQ(d,n,i[n])}}c.parentNode.replaceChild(d,c);f=d}}return f}function aQ(d,f,e){var c=ar("param");c.setAttribute("name",f);c.setAttribute("value",e);d.appendChild(c)}function aw(c){var d=aS(c);if(d&&d.nodeName=="OBJECT"){if(ah.ie&&ah.win){d.style.display="none";(function(){if(d.readyState==4){aT(c)}else{setTimeout(arguments.callee,10)}})()}else{d.parentNode.removeChild(d)}}}function aT(c){var d=aS(c);if(d){for(var e in d){if(typeof d[e]=="function"){d[e]=null}}d.parentNode.removeChild(d)}}function aS(c){var e=null;try{e=aL.getElementById(c)}catch(d){}return e}function ar(c){return aL.createElement(c)}function aM(c,e,d){c.attachEvent(e,d);al[al.length]=[c,e,d]}function ao(c){var d=ah.pv,e=c.split(".");e[0]=parseInt(e[0],10);e[1]=parseInt(e[1],10)||0;e[2]=parseInt(e[2],10)||0;return(d[0]>e[0]||(d[0]==e[0]&&d[1]>e[1])||(d[0]==e[0]&&d[1]==e[1]&&d[2]>=e[2]))?true:false}function az(d,h,c,e){if(ah.ie&&ah.mac){return}var g=aL.getElementsByTagName("head")[0];if(!g){return}var i=(c&&typeof c=="string")?c:"screen";if(e){aH=null;an=null}if(!aH||an!=i){var f=ar("style");f.setAttribute("type","text/css");f.setAttribute("media",i);aH=g.appendChild(f);if(ah.ie&&ah.win&&typeof aL.styleSheets!=aq&&aL.styleSheets.length>0){aH=aL.styleSheets[aL.styleSheets.length-1]}an=i}if(ah.ie&&ah.win){if(aH&&typeof aH.addRule==aD){aH.addRule(d,h)}}else{if(aH&&typeof aL.createTextNode!=aq){aH.appendChild(aL.createTextNode(d+" {"+h+"}"))}}}function ay(c,e){if(!aI){return}var d=e?"visible":"hidden";if(ak&&aS(c)){aS(c).style.visibility=d}else{az("#"+c,"visibility:"+d)}}function ai(d){var c=/[\\\"<>\.;]/;var e=c.exec(d)!=null;return e&&typeof encodeURIComponent!=aq?encodeURIComponent(d):d}var aR=function(){if(ah.ie&&ah.win){window.attachEvent("onunload",function(){var c=al.length;for(var d=0;d<c;d++){al[d][0].detachEvent(al[d][1],al[d][2])}var f=ag.length;for(var e=0;e<f;e++){aw(ag[e])}for(var g in ah){ah[g]=null}ah=null;for(var h in a){a[h]=null}a=null})}}();return{registerObject:function(c,g,e,d){if(ah.w3&&c&&g){var f={};f.id=c;f.swfVersion=g;f.expressInstall=e;f.callbackFn=d;aG[aG.length]=f;ay(c,false)}else{if(d){d({success:false,id:c})}}},getObjectById:function(c){if(ah.w3){return av(c)}},embedSWF:function(m,g,j,h,e,c,d,k,i,l){var f={success:false,id:g};if(ah.w3&&!(ah.wk&&ah.wk<312)&&m&&g&&j&&h&&e){ay(g,false);aj(function(){j+="";h+="";var s={};if(i&&typeof i===aD){for(var q in i){s[q]=i[q]}}s.data=m;s.width=j;s.height=h;var p={};if(k&&typeof k===aD){for(var r in k){p[r]=k[r]}}if(d&&typeof d===aD){for(var n in d){if(typeof p.flashvars!=aq){p.flashvars+="&"+n+"="+d[n]}else{p.flashvars=n+"="+d[n]}}}if(ao(e)){var o=aA(s,p,g);if(s.id==g){ay(g,true)}f.success=true;f.ref=o}else{if(c&&au()){s.data=c;ae(s,p,g,l);return}else{ay(g,true)}}if(l){l(f)}})}else{if(l){l(f)}}},switchOffAutoHideShow:function(){aI=false},ua:ah,getFlashPlayerVersion:function(){return{major:ah.pv[0],minor:ah.pv[1],release:ah.pv[2]}},hasFlashPlayerVersion:ao,createSWF:function(c,d,e){if(ah.w3){return aA(c,d,e)}else{return undefined}},showExpressInstall:function(d,c,f,e){if(ah.w3&&au()){ae(d,c,f,e)}},removeSWF:function(c){if(ah.w3){aw(c)}},createCSS:function(d,c,e,f){if(ah.w3){az(d,c,e,f)}},addDomLoadEvent:aj,addLoadEvent:aC,getQueryParamValue:function(d){var c=aL.location.search||aL.location.hash;if(c){if(/\?/.test(c)){c=c.split("?")[1]}if(d==null){return ai(c)}var e=c.split("&");for(var f=0;f<e.length;f++){if(e[f].substring(0,e[f].indexOf("="))==d){return ai(e[f].substring((e[f].indexOf("=")+1)))}}}return""},expressInstallCallback:function(){if(aU){var c=aS(ac);if(c&&aJ){c.parentNode.replaceChild(aJ,c);if(ad){ay(ad,true);if(ah.ie&&ah.win){aJ.style.display="block"}}if(ap){ap(at)}}aU=false}}}}();return a});STK.register("common.flash.imgUpload",function(c){var e=document.documentElement,a=document.body;var d={getScroll:function(){var i,g,f,j;if(e&&e.scrollTop){i=e.scrollTop;g=e.scrollLeft;f=e.scrollWidth;j=e.scrollHeight}else{if(a){i=a.scrollTop;g=a.scrollLeft;f=a.scrollWidth;j=a.scrollHeight}}return{t:i,l:g,w:f,h:j}},getScreen:function(){var f={};if(c.IE){f.w=e.clientWidth;f.h=e.clientHeight}else{f.w=window.innerWidth;f.h=window.innerHeight}return f}};var b=function(f){var g={cn:"zh_CN",tw:"zh_TW"};f=f.toLowerCase();f=f.replace(/zh-/g,"");return g[f]};return function(g,m){var j={version:$CONFIG.version,swf_path:$CONFIG.jsPath+"home/static/swf/img/",service:g.service,ed_swf:g.swf||"PhotoEditor.swf",exp_swf:"expressInstall.swf",h:g.h||385,w:g.w||528,f_version:"10.0.0",channel:g.id+"_channel",id_panel:g.id+"_panel",id_swf:g.id+"_swf"};var i={},n,f;var l={init:function(){m.init&&m.init(i,g)},setHeight:function(o){if(!c.IE){k.getFlash(j.id_swf).height=o}},upComplate:function(o){g.sucess&&g.sucess(o);n.style.display="none";i.destory()},closeEditor:function(){n.style.display="none";i.destory();m.close&&m.close(i,g)},suda:function(o){SUDA&&SUDA.uaTrack&&SUDA.uaTrack("meitu","v4||"+o)}};var h={version:j.version,language:b($CONFIG.lang),channel:j.channel,JSHandler:"STK.core.util.listener.fire",initFun:"init",changeFlashHeightFun:"setHeight",uploadCompleteFun:"upComplate",closePhotoEditorFun:"closeEditor",suda:"suda"};var k={init:function(){if(!g.id){return}n=c.E(j.id_panel);f=c.E(j.id_swf);if(!n){n=c.C("div");n.id=j.id_panel;a.appendChild(n)}if(!f){f=c.C("div");f.id=j.id_swf;n.appendChild(f)}n.style.display="none";if(!k.getFlash(j.id_swf)){k.build()}},checkAction:function(p,o){var q=STK.core.util.listener.list;return !!(q[p]&&q[p][o])},bindEvt:function(o){for(key in o){l[o[key]]&&!k.checkAction(j.channel,o[key])&&STK.core.util.listener.register(j.channel,o[key],l[o[key]])}},build:function(){var p={menu:"true",scale:"noScale",allowFullscreen:"true",allowScriptAccess:"always",bgcolor:"#FFFFFF",wmode:c.IE?"window":"transparent",base:j.swf_path};var o={id:g.id};k.bindEvt(h);c.kit.extra.swfobject.embedSWF(j.swf_path+j.ed_swf+"?version="+j.version,j.id_swf,j.w,j.h,j.f_version,j.swf_path+j.exp_swf,h,p,o)},getFlash:function(){if(navigator.appName.indexOf("Microsoft")!=-1){return window[g.id]}else{return document[g.id]}},setPos:function(){var q,o,r,p,u=d.getScroll(),s=d.getScreen();r=Math.round(j.h>s.h?(s.h/5+u.t):((s.h-j.h)/2+u.t));p=Math.round(j.w>s.w?(s.w/5+u.l):((s.w-j.w)/2+u.l));q=(g.pos.t-1)||r;o=g.pos.l||p;n.style.zIndex=g.zIndex||20000;c.setStyle(n,"position","absolute");c.setStyle(n,"left",o+"px");c.setStyle(n,"top",q+"px");k.autoScroll(u.t,u.t+(q-r))},autoScroll:function(q,o,p){var v,u,r,s=8,t;s=p||s;t=q-o;u=[t];u[s]=0;r=1;for(r;r<s;r++){u[r]=(t=t/2)}clearInterval(v);v=setInterval(function(){if(u.length){window.scrollTo(0,o+u.shift());return}clearInterval(v)},30)}};i.show=function(o){o&&(g.id=o);n&&(n.style.display="");k.setPos();return this};i.hide=function(){n&&(n.style.display="");return this};i.setPars=function(p){var o={imageURL:p||"",uploadURL:j.service};k.getFlash(j.id_swf).editPhoto(o);return this};i.getSwf=k.getFlash;i.destory=function(){if(c.IE){for(key in h){l[h[key]]&&STK.core.util.listener.remove(j.channel,h[key],l[h[key]])}n.innerHTML=""}};k.init();return i}});STK.register("common.bubble.image",function($){var cfg=window.$CONFIG;var actionURL=/service/.test(document.location.host)?"/widget/public/aj_uploadpic.php":"/public/aj_uploadpic.php";var TEMPOUTER='<!-- 发布器图片弹层 --><div class="WB_widgets WB_tips_show" node-type="outer" style="position:absolute;"> <span class="ts_arr"></span><div class="Wb_tipsshow_wrap"> <a href="#" onclick="return false;" action-type="close" node-type="close" class="WB_tips_show_close" title="关闭">关闭</a> <!-- 内容区 --><div class="tipsshow_detail layer_pic" node-type="inner"><div node-type="upload_form" class="detail_choose"><form node-type="form" action="'+actionURL+'" method="post" target="upload_iframe" enctype="multipart/form-data"><p class="pic_btn clearfix"><a href="#" onclick="return false;" class="WB_btnA"><span>上传图片</span></a><input type="file" hidefoucs="true" node-type="fileBtn" contenteditable="false" name="pic" id="activity_img" class="file_input"><input type="hidden" name="appkey" value="'+($CONFIG.appkey||"")+'"/  style="display:none;"><input type="hidden" name="wsrc" value="'+($CONFIG.wsrc||"app_topic_base")+'" style="display:none;" /></p></form><p class="extip">请选择小于5M的gif、jpg、png图片</p></div><div node-type="upload_status"></div></div><iframe src="" node-type="upload_iframe" id="upload_iframe" name="upload_iframe" style="display:none;"></iframe><!-- /内容区 --> </div></div><!-- /发布器图片弹层 -->';var LOADING='<div class="detail_loading"><p class="extip"><em class="icon_loading WB_loadingbgS"></em>图片正在上传，请稍后</p><p class="pic_btn clearfix"><a href="#" onclick="return false;" action-type="cancel" class="WB_btnA"><span>取消上传</span></a></p></div>';var FAIL='<div class="detail_faila"><p class="extip"><i class="content_velm"></i><span class="maintip"><em class="WB_icon WB_tipS_warn"></em><em class="WB_icon_txt">图片上传失败</em><em class="subtip">##REASON##</em></span></p><p class="pic_btn clearfix"><a href="#" onclick="return false;" action-type="retry" class="WB_btnA"><span>重新上传</span></a></p></div>';var SHOW_IMG='<div class="pic_show_layer"><p class="pic_name">##PIC_NAME##</p><div class="pic_show"><img src="##PIC_URL##" alt="" /></div><p class="pic_action"><a href="#" onclick="return false;" action-type="delete" class="pic_del" href="">删除</a></p></div>';var DEFAULT_WORD="#L{分享图片}";var IMGMASK="weibo.com/";var bub,outer,inner,content,cancel,cacheTab,wmark,uppid;var imgName,cacheData,dEvent,uniqueKey;var that={};var nodes,location;var position=$.core.dom.position;var addEvent=$.core.evt.addEvent;var rmEvent=$.core.evt.removeEvent;var L=$.kit.extra.language;var bind=function(){$.custEvent.define(that,"uploaded");$.custEvent.define(that,"hide");$.custEvent.define(that,"insert");$.custEvent.define(that,"deletePIC");$.custEvent.define(that,"picLoad");dEvent=$.core.evt.delegatedEvent(outer);upLoad.bind()};var upLoad={initDom:function(){var uploadDOM;cacheTab=upLoad;nodes.close=(bub.getDomList().close)[0];uploadDOM=$.kit.dom.parseDOM($.core.dom.builder(outer).list);nodes=$.kit.extra.merge(nodes,uploadDOM)},bind:function(){addEvent(nodes.fileBtn,"change",bindDOMFuncs.upload);dEvent.add("delete","click",upLoad.deletePic);dEvent.add("cancel","click",upLoad.cancelUpload);dEvent.add("retry","click",upLoad.retry);dEvent.add("close","click",upLoad.close)},destroy:function(){rmEvent(nodes.inputCover,"mousemove",upLoad.ajust);rmEvent(nodes.fileBtn,"change",bindDOMFuncs.upload)},handle:function(){if(uniqueKey==null){return}var ret;try{ret=nodes.upload_iframe.contentWindow.document.body.innerHTML}catch(e){}if(ret==null||ret.indexOf("{")!=0){nodes.inner.innerHTML=FAIL;return}ret=eval("("+ret+")");ret.code=parseInt(ret.code);if(!ret||ret.code>100000){var msg="";switch(ret.code){case 100001:msg="#L{系统繁忙}";break;case 100002:msg="#L{没有登录}";break;default:msg=ret.msg}nodes.upload_status.innerHTML=FAIL.replace(/##REASON##/g,msg)}else{upLoad.stopUpload();if(cancel){nodes.inner.innerHTML=WAIT;nodes.close.style.display="";cancel=false}else{upLoad.rendSucc({pid:ret.data})}}},rendLoad:function(){nodes.close.style.display="none";nodes.form.submit();upLoad.formStaus(false);nodes.upload_status.innerHTML=LOADING},rendSucc:function(opts){var url=$.common.extra.imageURL(opts.pid);var arr=[],name,str;imgName=imgName||opts.pid;arr=imgName.split(/\/|\\/);name=arr[arr.length-1];arr=name.split(".");if(arr.length>1&&$.bLength(arr[0])>20){arr[0]=$.leftB(arr[0],20);str=[arr[0],"...",arr[1]].join("")}else{str=name}uppid=opts.pid;bindDOMFuncs.loadPic({url:url,value:str,pid:opts.pid,name:opts.name})},deletePic:function(){upLoad.formStaus(true);nodes.close.style.display="";$.custEvent.fire(that,"deletePIC",{text:L(DEFAULT_WORD)})},stopUpload:function(){upLoad.formStaus(true);nodes.close.style.display=""},cancelUpload:function(){cancel=true;$.removeEvent(nodes.upload_iframe,"load",upLoad.handle);upLoad.formStaus(true);upLoad.stopUpload()},formStaus:function(status){if(status==null){status=false}$.setStyle(nodes.upload_form,"display",(status?"":"none"));$.setStyle(nodes.upload_status,"display",(status?"none":""))},retry:function(){upLoad.formStaus(true);nodes.form.reset();nodes.close.style.display=""},close:function(){$.custEvent.fire(that,"hide");$.custEvent.fire(that,"deletePIC",{text:L(DEFAULT_WORD)})}};var bindDOMFuncs={upload:function(){uniqueKey=new Date().getTime();imgName=nodes.fileBtn.value;if($.core.str.trim(imgName)===""){return}$.addEvent(nodes.upload_iframe,"load",upLoad.handle);upLoad.rendLoad()},loadPic:function(obj){upLoad.formStaus(false);nodes.upload_status.innerHTML=SHOW_IMG.replace(/##([^#]+)##/g,function(a,b){switch(b){case"PIC_NAME":return obj.value||"";case"PIC_URL":return decodeURIComponent(obj.url)}});nodes.close.style.display="none";$.core.evt.custEvent.fire(that,"uploaded",{text:L(DEFAULT_WORD),pid:obj.pid||""})}};var bindCustEvtFuncs={};that.reset=function(){uniqueKey=null;upLoad.retry()};that.getBub=function(){return bub};return function(el,opts){if(!$.isNode(el)){throw"common.bubble.image need el as first parameter!"}location=window.location.href;if(bub==null){bub=$.module.layer(L(TEMPOUTER));nodes=$.kit.dom.parseDOM(bub.getDomList());outer=nodes.outer;upLoad.initDom();if(opts&&opts.pid){var url=$.common.extra.imageURL(opts.pid);bindDOMFuncs.loadPic({url:url,pid:opts.pid})}else{if(opts&&opts.url){bindDOMFuncs.loadPic({url:opts.url})}}bind();$.kit.dom.layoutPos(bub.getOuter(),el,{offsetX:-9,offsetY:3})}that.bubble=bub;bub.show();return that}});STK.register("common.topic.delegate",function(h){var a,j,l,n=location.host;var c=h.kit.extra.language;var b=/service/.test(n)?"http://service.weibo.com/reg/loginindex.php?appsrc=1lzBEX&backurl=http%3A%2F%2F"+n+"%2Fwidget%2Fpublic%2FloginProxy.html&vsrc=app_topic&showlogo=0":"http://service.weibo.com/reg/loginindex.php?appsrc=1lzBEX&backurl=http%3A%2F%2F"+n+"%2Fpublic%2FloginProxy.html&vsrc=app_cmtbox&showlogo=0",k=/service/.test(n)?"http://weibo.com/signup/signup.php?vsrc=app_widget_topic_width&backurl=http%3A%2F%2F"+n+"%2Fwidget%2Fpublic%2FloginProxy.html&from=zw&showlogo=0&appsrc=1lzBEX":"http://weibo.com/signup/signup.php?vsrc=app_widget_topic_width&backurl=http%3A%2F%2F"+n+"%2Fpublic%2FloginProxy.html&showlogo=0&appsrc=1lzBEX",d="http://weibo.com/signup/full_info.php?appsrc=1lzBEX&backurl=http%3A%2F%2Fweibo.com&showlogo=0&vsrc=app_sharepop&diy=&from=zw&regbackurl=http%3A%2F%2F&c=&refer=http%3A%2F%2F";var g=c('<#et userlist data><div class="user_info clearfix"><div class="info_pic"><a href="http://weibo.com/u/${data.uid}" target="_blank"><img alt="${data.name}" src="${data.icon}"></a></div><div class="info_detail"><p class="detail_name"><a title="${data.name}" href="http://weibo.com/u/${data.uid}" target="_blank">${data.short_name}</a><#if (data.user_type == 0)><span class="WB_approve feed_icon"></span><#elseif (data.user_type == 1)><span class="WB_approve_co feed_icon"></span><#elseif (data.user_type == 2)><span class="WB_ico_club feed_icon"></span></#if></p><p class="info_add">${data.province},${data.city}</p></div></div><ul class="user_atten clearfix"><li><a href="http://weibo.com/${data.uid}/follow" target="_blank"><strong>${data.attmenum}</strong></a><span>#L{关注}</span></li><li><a href="http://weibo.com/${data.uid}/fans" target="_blank"><strong>${data.meattnum}</strong></a><span>#L{粉丝}</span></li><li class="last"><a href="http://weibo.com/${data.uid}/profile" target="_blank"><strong node-type="weibo_count">${data.mblognum}</strong></a><span>#L{微博}</span></li></ul>');var m=c('<div class="info_login"><p>#L{已经有新浪账号，请}<a href="'+b+'" onclick="return false;" action-type="login">#L{登录}</a></p><p>#L{还没有微博账号？}</p><a class="WB_btngB" href="'+k+'" onclick="return false;" action-type="regist"><span>#L{立即注册}</span></a></div>');var i=c('<#et userlist data><div class="info_login"><p class="login_mail"><a href="http://weibo.com/u/${data.uid}" target="_blank">${data.name}</a></p><p class="login_tip"><span class="WB_tipS_warn small_state_icon"></span><span class="small_state_info">#L{您的帐号尚未开通微博}</span></p><a class="WB_btngB" href="'+d+'" onclick="return false;" action-type="fullinfo"><span>#L{立即开通}</span></a></div>');function f(){if(l==true){return}l=true;var o=h.common.trans.topic.getTrans("person_info",{onComplete:function(r){var q,s;switch(r.code){case"100000":if(r.data&&r.data.name){if(h.bLength(r.data.name)>16){r.data.short_name=h.leftB(r.data.name,14)+"…"}else{r.data.short_name=r.data.name}}if(r.data.icon){s=g}else{if(r.data.name){s=i}else{s=m}}s=h.core.util.easyTemplate(s,r.data);break}var p=h.sizzle('div[class="topic_infomain WB_loginButton"]',e);if(p.length>0){p[0].innerHTML=s}l=null},onFail:function(){l=null}});o.request({wsrc:$CONFIG.wsrc||"app_topic_base"})}var e;return{init:function(o,q){if(o==null){return}if(q&&q.pl){e=q.pl}var p=h.sizzle('li[class="current"]',o);if(p.length>0){a=p[0];j=a.getAttribute("action-data").replace("key=","")}return j},changeTab:function(o){if(o.data.key==j){return}a&&(a.className="");o.el.className="current";a=o.el;j=a.getAttribute("action-data").replace("key=","");h.common.channel.feed.fire("reload",j)},login:function(o,q){window.App=window.App||{};App.loginBackUrlCallBack=function(){if(q){q();f();!/service/.test(n)&&location.reload()}else{location.reload()}try{var r=scope.loginKit().uid;var s=$CONFIG.refer||"";(new Image()).src="//rs.sinajs.cn/r.gif?uid="+r+"&appid="+$CONFIG.appkey+"&refer="+s+"&cat=2&rnd="+(+new Date())}catch(t){}};var p=b;window.open(p,"login","width=750,height=620")},logout:function(){},regist:function(o,q){window.App=window.App||{};App.loginBackUrlCallBack=function(){if(q){q();f()}else{location.reload()}};var p=k;window.open(p,"regist","width=750,height=620")},fullinfo:function(){if(typeof $CONFIG!="undefined"&&typeof $CONFIG.is_sina_user!="undefined"&&$CONFIG.is_sina_user=="1"){var o=d;window.open(o,"fullinfo","width=950,height=620");return true}return false}}});STK.register("common.editor.widget.image",function(a){return function(e){var f={};var g,d,j,k,c;var l=function(m,n){g.API.insertText(n.value);d.getBub().hide()};var b=function(m,n){var o=g.API.getWords();if(o.length==0){g.API.insertText(n.text)}g.API.addExtraInfo(n.pid);k=false};var h=function(m,n){g.API.delWords(n.text);g.API.addExtraInfo("");clearInterval(c);d.reset()};var i=function(m){if(a.common.topic.delegate.fullinfo()){return}if(scope.loginKit().isLogin==false){a.common.topic.delegate.login(null,i);return}if(k){return}try{a.core.evt.preventDefault()}catch(n){}if(m&&m.pid&&typeof m.pid=="string"){d=a.common.bubble.image(g.nodeList[j],{pid:m.pid});c=setInterval(function(){d.bubble.setLayout(g.nodeList[j],{offsetX:-29,offsetY:5})},200)}else{if(m&&m.url&&typeof m.url=="string"){d=a.common.bubble.image(g.nodeList[j],{url:m.url})}else{d=a.common.bubble.image(g.nodeList[j])}}m.pid=g.API.getExtra();if(!m.url&&!m.pid){d.reset()}a.custEvent.add(d,"uploaded",b);a.custEvent.add(d,"insert",l);a.custEvent.add(d,"deletePIC",h);a.custEvent.add(d,"hide",function(){a.custEvent.remove(d,"hide",arguments.callee);a.custEvent.remove(d,"uploaded",b);a.custEvent.remove(d,"insert",l);a.custEvent.remove(d,"deletePIC",h);a.custEvent.remove(d,"changeType");f.hide();k=false});a.core.evt.custEvent.fire(f.custKeyShow,"show",["image"])};f.init=function(m,n,o){g=m;j=n;a.addEvent(m.nodeList[j],"click",i);if(o&&o.pid){i(o)}else{if(o&&o.url){i(o)}}};f.clear=function(){};f.show=function(){d.getBub().show()};f.hide=function(){if(d){d.getBub().hide()}k=false};f.resetBubble=function(m){if(d){d.bubble.setLayout(m,{offsetX:-29,offsetY:5})}};f.destroy=function(){g=null};f.custKeyShow=a.core.evt.custEvent.define(f,"show");return f}});STK.register("common.editor.widget.topic",function(a){return function(){var f={};var h=a.kit.extra.language;var e,g;var b={text:h("##L{在这里输入你想要说的话题}#")};var d=function(n){var o=n;var m=e.nodeList.textEl;var j=m.value;var l=o.length-2;if(j.indexOf(o)!=-1){var k=j.indexOf(o);a.kit.extra.textareaUtils.setCursor(m,k+1,l)}else{e.API.insertText(o);var i=a.kit.extra.textareaUtils.getCursorPos(m);a.kit.extra.textareaUtils.setCursor(m,i-(l+1),l)}};var c=function(){d(b.text)};f.init=function(i,j,k){e=i;g=j;a.addEvent(i.nodeList[g],"click",c)};f.hide=function(){};f.destroy=function(){e=null};return f}});STK.register("common.extra.shine",function(b){var a=function(c){return c.slice(0,c.length-1).concat(c.concat([]).reverse())};return function(e,q){var n=b.parseParam({start:"#fff",color:"#fbb",times:2,step:5,length:4},q);var f=n.start.split("");var c=n.color.split("");var h=[];for(var m=0;m<n.step;m+=1){var o=f[0];for(var k=1;k<n.length;k+=1){var l=parseInt(f[k],16);var g=parseInt(c[k],16);o+=Math.floor(parseInt(l+(g-l)*m/n.step,10)).toString(16)}h.push(o)}for(var m=0;m<n.times;m+=1){h=a(h)}var p=false;var d=b.timer.add(function(){if(!h.length){b.timer.remove(d);return}if(p){p=false;return}else{p=true}e.style.backgroundColor=h.pop()})}});if(typeof scope==="undefined"){scope={}}scope.loginKit=function(){if(window.scope){var c=window.scope.current_user_weibo||window.scope.current_user_sina;if(c){return{uid:c,isLogin:!!c}}}if(window.$CONFIG){var c=window.$CONFIG.current_user_weibo||window.$CONFIG.current_user_sina||window.$CONFIG.uid||window.$CONFIG.$uid;if(c){return{uid:c,isLogin:!!c}}}var b=document.cookie+";";var f=["SUP","=([^;]*)?;"].join("");var a=["(\\?|&)","uid","=([^&]*)(&|$)"].join("");var e=b.match(new RegExp(f,"i"));e=(e)?e[1]||"":"";e=unescape(e);var c=e.match(new RegExp(a));c=(c)?c[2]||"":"";var d=scope["$oid"];return{uid:c,isLogin:!!c,isAdmin:c&&d&&(c==d)}};scope.$isLogin=function(){return scope.loginKit().isLogin};scope.$isAdmin=function(){return scope.loginKit().isAdmin};STK.register("common.topic.basePublisher",function(g){var h=g.kit.extra.language;var d=h('<div class="publish_state"><cite class="WB_tipB_ok commentInput_state_icon"></cite><cite class="state_txt"><cite class="fir_txt">#L{微博发布成功！}</cite><cite class="pubsta_info W_txtb">#L{数据同步可能延迟，请耐心等待}</cite></cite></div>');var e=h('<div class="publish_state"><cite class="WB_tipB_err commentInput_state_icon"></cite><cite class="state_txt"><cite class="fir_txt">##ERROR##</cite><cite class="pubsta_info W_txtb">#L{如需帮助请}<a href="http://weibo.com/weibokefu" target="_blank">@#L{微博客服}</a> #L{或者致电} 400 690 0000</cite></cite></div>');var c=h("#L{系统繁忙}");var a={options:{limitNum:140,tipText:h(""),count:"disable",atSwitch:true},oncount:function(){var k=g.trim(this.doms.textEl.value);var j=g.bLength(k);var l=false;var i=Math.floor((this.opts.options.limitNum*2-j)/2);this.doms.count.innerHTML=i;this.doms.count.className=(i>=0)?"weibo_count":"weibo_count S_error";if(j==0||j>this.opts.options.limitNum*2){l=false}else{l=true}if(this.canPublish!=l){this.canPublish=l;this.doms.publishBtn.className=this.canPublish?"publisher_submit_btn":"publisher_submit_btn submit_disabled"}}};var b;function f(l,i){var p=this;var m;this.node=l;this.opts=i||a||{};this.canPublish=false;var q=g.common.editor.base(l,this.opts.options);this.editor=q;var k=q.nodeList;this.doms=k;this.smileWidget=g.common.editor.widget.face();this.imageWidget=g.common.editor.widget.image();q.widget(this.smileWidget,"smileyBtn");q.widget(this.imageWidget,"imageBtn");q.widget(g.common.editor.widget.topic(),"topicBtn");g.custEvent.add(this.smileWidget,"show",function(){n()});g.custEvent.add(this.imageWidget,"show",function(){j()});g.addEvent(k.publishBtn,"click",o);g.core.evt.hotKey.add(k.textEl,"ctrl+enter",o);g.addEvent(k.textEl,"focus",function(){m=setInterval(function(){a.oncount.apply(p)},200);j();var r=q.API.getExtra();r&&p.imageWidget.show();r||n()});g.addEvent(k.textEl,"blur",function(){clearInterval(m)});g.addEvent(k.textEl,"keyup",function(){a.oncount.apply(p)});a.oncount.apply(this);function o(){if(p.canPublish){p.onpublish()}else{g.common.extra.shine(k.textEl)}}function j(){if(p.smileWidget&&typeof p.smileWidget.hide=="function"){p.smileWidget.hide()}}function n(){if(p.imageWidget&&typeof p.imageWidget.hide=="function"){p.imageWidget.hide()}}}f.prototype.onpublish=function(){var j=this;if(g.common.login.getLoginStatus.isLogin()==false){g.common.topic.login.login();return}if(g.common.topic.login.fullinfo()==false){return}if(b==true){return}b=true;var k={app_src:$CONFIG.app_src||"",content:this.editor.API.getWords(),pic_id:this.editor.API.getExtra(),return_type:2,refer:encodeURIComponent(document.referrer),vsrc:"base_topic",wsrc:$CONFIG.wsrc||"app_topic_base",ext:"login=>1;url=>"+encodeURIComponent(document.referrer),html_type:2};this.doms.publishBtn.className="publisher_submit_btn submit_ing";var i=g.common.trans.topic.getTrans("addmblog",{onComplete:function(l){switch(l.code){case"100000":j.doms.textEl.value="";j.doms.textEl.setAttribute("extra","");j.doms.publishBtn.className="publisher_submit_btn";g.common.channel.topic.fire("publish",[l.data]);j.showTips();j.editor.closeWidget();break;default:j.doms.publishBtn.className="publisher_submit_btn";j.showTips(l.msg);break}b=null},onFail:function(){j.doms.publishBtn.className="publisher_submit_btn";j.showTips(c);b=null}});i.request(k)};f.prototype.showTips=function(k){var j,i=this;if(k==null){j=d}else{j=e.replace(/##ERROR##/,k)}this.deleteTips();g.core.dom.insertHTML(this.doms.textEl.parentNode,j,"beforeend");this.timer=setTimeout(function(){i.deleteTips();i.doms.textEl.value=("#"+i.topic+"#");clearTimeout(i.timer);i.timer=null},2000)};f.prototype.deleteTips=function(){if(this.timer){clearTimeout(this.timer);this.timer=null}var i=g.core.dom.next(this.doms.textEl);if(i&&g.isNode(i)){g.removeNode(i)}};f.prototype.setTopic=function(i){this.topic=i;this.doms.textEl.value="#"+i+"#";a.oncount.apply(this)};f.prototype.destroy=function(){};return f});STK.register("comp.topic.publisher",function(a){return function(x,q){var m={};var G,D,s;var J,h,c,i,I;var o,C,r,B=0,w=0,u=0;var E='<u class="topic_arrow S_link_l_b"></u>';function e(L,K){switch(K){case"hide":L.style.width=o-2+"px";J.style.right=259+"px";J.className="aside_switch_btn switch_off";return;case"show":L.style.width=C;J.style.right=517+"px";J.className="aside_switch_btn";return;default:}}function f(){r=G.topicList.parentNode.offsetWidth;var K=i.parentNode;w=K.offsetLeft+K.offsetWidth-r;if(w<=0){G.prev.style.display="none";G.next.style.display="none";a.core.dom.setStyle(G.topicList.parentNode,"margin","0")}else{G.prev.style.display="block";G.next.style.display="block";G.topicList.parentNode.setAttribute("style","")}r=G.topicList.parentNode.offsetWidth;w=K.offsetLeft+K.offsetWidth-r;w=w<=0?0:-w;if(B>0){B=0;y()}if(w&&B<w){B=w;y()}}function H(K){var N=K.offsetWidth;var L=K.offsetLeft;var M=L+N-5-2;var O=r+Math.abs(B);if(M>O){return["right",B-M-7+O]}if(L<Math.abs(B)){return["left",-L]}return["ok",B]}function y(){a.tween(G.topicList,{}).finish({left:B})}function p(){var K=I.length-1;var M,Q=9999,N;for(var P=0;P<=K;P++){var L=Math.abs(I[P].parentNode.offsetLeft-Math.abs(B)-u);if(L<Q){Q=L;M=I[P];N=P}}var O=H(M.parentNode);switch(O[0]){case"right":M=I[N-1];break;case"left":M=I[N+1];break;case"ok":break}t(M)}function j(){var K=G.textEl.value.length;G.textEl.setAttribute("range",K+"&0")}function t(M){if(a.isNode(M)){var K=M.parentNode;a.removeClassName(c.parentNode,"topic_selected");a.removeNode(a.core.dom.next(c));a.addClassName(K,"topic_selected");a.addHTML(K,E);var L=H(K);switch(L[0]){case"right":case"left":B=L[1];y();break;case"ok":break}c=M;a.common.channel.topic.fire("topic_change",[c.innerHTML]);s.setTopic(c.innerHTML.replace(new RegExp("#","gi"),""));$CONFIG.short_url&&(G.textEl.value+=" "+$CONFIG.short_url);j()}}function k(){var L=a.common.login.getLoginStatus.uid();var K="//rs.sinajs.cn/tmp.gif?id=topicbase&action=pv&uid="+L+"&url="+encodeURIComponent(document.referrer)+"&r="+(new Date()).valueOf();STK.pvLogImage=new Image();STK.pvLogImage.src=K}var b={asideSwitchBtn:function(){e(h,J.className==="aside_switch_btn"?"hide":"show");f();B=0;y();t(c)},topic:function(K){t(K.el)},prev:function(K){var L=B+r;u=c.parentNode.offsetLeft+B;B=L>0?0:L;y();p()},next:function(K){var L=B-r;u=c.parentNode.offsetLeft+B;B=L<w?w:L;y();p()}};var z=function(){v();d();A();g();l();n()};var v=function(){if(x==null||(x!=null&&!a.core.dom.isNode(x))){throw"[comp.topic.publisher]:argsCheck()-The param node is not a DOM node."}q=a.core.obj.parseParam({html:""},q)};var d=function(){G=a.kit.dom.parseDOM(a.builder(x).list);J=a.E("asideSwitchBtn");h=a.E("mainPart")};var A=function(){s=new a.common.topic.basePublisher(x);s.setTopic($CONFIG.tag);$CONFIG.short_url&&(G.textEl.value+=" "+$CONFIG.short_url);j();o=a.core.dom.sizzle(".WB_weibo_topic",document.body);o=o.length>0?o[0].offsetWidth:821;h&&(C=h.style.width||o-261);I=a.core.dom.sizzle(".topic_item_a",x);if(I.length>0){i=I[I.length-1];f();c=I[0];t(c)}k()};var g=function(){D=a.core.evt.delegatedEvent(x);D.add("topic","click",b.topic);a.addEvent(J,"click",b.asideSwitchBtn);a.addEvent(G.prev,"click",b.prev);a.addEvent(G.next,"click",b.next)};var l=function(){};var n=function(){};var F=function(){D.remove("topic","click",b.topic);a.removeEvent(J,"click",b.asideSwitchBtn);a.removeEvent(G.prev,"click",b.prev);a.removeEvent(G.next,"click",b.next)};z();m.destroy=F;return m}});STK.pageletM.register("pl.topic.publisher",function(d){var c={};var b=d.E("pl_topic_publisher");var a=d.comp.topic.publisher(b,c);return a});STK.register("kit.dom.lastChild",function(b){var a=b.core.dom.prev;return function(d){var c=d.lastChild;if(c&&c.nodeType!=1){c=a(c)}return c}});STK.register("common.login.getLoginStatus",function(d){function a(){if(window.scope){var g=window.scope.current_user_weibo||window.scope.current_user_sina;if(g){return{uid:g,isLogin:!!g}}}if(window.$CONFIG){var g=window.$CONFIG.current_user_weibo||window.$CONFIG.current_user_sina||window.$CONFIG.uid||window.$CONFIG.is_login||window.$CONFIG.$uid;if(g){return{uid:g,isLogin:!!g}}}var f=document.cookie+";";var i=["SUP","=([^;]*)?;"].join("");var e=["(\\?|&)","uid","=([^&]*)(&|$)"].join("");var h=f.match(new RegExp(i,"i"));h=(h)?h[1]||"":"";h=unescape(h);var g=h.match(new RegExp(e));g=(g)?g[2]||"":"";return{uid:g,isLogin:!!g}}function c(){return a().uid}function b(){return a().isLogin}return{uid:c,isLogin:b}});STK.register("common.topic.feedFilter",function(e){var h,a,j,c=e.kit.extra.language;var b=0,f;var i;var g;var d={setTopic:function(k){f=k;d.changeToTab(0);d.getFeedInfo(0)},setFilter:function(k){var l=k.data.index;if(l==2&&e.common.topic.login.fullinfo()==false){return}d.changeToTab(l);d.getFeedInfo(l)},changeToTab:function(m){if(i==null){i=e.sizzle("li",a.nav)}e.removeClassName(i[b],"nav_current");var k=e.kit.dom.lastChild(i[b]);var l=k.cloneNode(true);e.removeNode(k);e.addClassName(i[m],"nav_current");i[m].appendChild(l);if(m!=0){a.top_feed&&(a.top_feed.style.display="none")}else{a.top_feed&&(a.top_feed.style.display="")}b=m},setCountInfo:function(l){var k;if(typeof l=="number"){k=l}else{if(typeof l=="boolean"&&l==true){k=a.count_info.innerHTML.replace(/\D/g,"")*1+1}}a.count_info.innerHTML=(l==null||k==0)?"":c('<a target="_blank" href="http://s.weibo.com/weibo/'+f+'&scope=ori" class="weibo_all_link">#L{查看}'+k+"#L{条相关微博}</a>")},getFeedInfo:function(){if(j==true){return}if(b==2&&e.common.login.getLoginStatus.isLogin()==false){d.setCountInfo();e.core.evt.custEvent.fire(g.custKeySearchFail,"needlogin",[]);return}var l={app_src:$CONFIG.app_src,tag:f,og:encodeURIComponent($CONFIG.og),filter:b,language:$CONFIG.language,is_base:($CONFIG.vsrc=="base_topic"?1:0),block_key:$CONFIG.block_key||""};j=true;var k=e.common.trans.topic.getTrans("search_topic",{onComplete:function(m){switch(m.code){case"100000":d.setCountInfo(m.data.total_number);e.core.evt.custEvent.fire(g.custKeySearchSucc,"success",[m.data]);break;default:e.core.evt.custEvent.fire(g.custKeySearchFail,"failure",[m.data]);break}j=null},onFail:function(){e.core.evt.custEvent.fire(g.custKeySearchFail,"failure",[ret.data]);j=null}});k.request(l)}};return function(k,l){a=e.kit.dom.parseDOM(e.builder(k).list);f=l;h=e.core.evt.delegatedEvent(k);h.add("filter","click",d.setFilter);g={setTopic:d.setTopic,setCountInfo:d.setCountInfo,reload:d.getFeedInfo,autoload:d.getFeedInfo};g.custKeySearchSucc=e.core.evt.custEvent.define(g,"success");g.custKeySearchFail=e.core.evt.custEvent.define(g,"failure");g.custKeySearchFail=e.core.evt.custEvent.define(g,"needlogin");return g}});STK.register("kit.dom.parentElementBy",function(a){return function(f,b,d){if(!f||!b){throw new Error("传入的参数为空")}var c=0,e;f=f.parentNode;while(f.parentNode){c++;e=d(f);if(e===false){return false}else{if(e===true){return f}else{if(e===b){return null}}}f=f.parentNode;if(c>30000){return false}}return null}});STK.register("ui.tipPrototype",function(a){var b=10003;return function(d){var e,i,h,g,c;var f='<div node-type="outer" class="WB_widgets W_layer" style="position: absolute; display:none;" ><div node-type="inner" class="bg"></div></div>';e=a.parseParam({direct:"up",showCallback:a.core.func.empty,hideCallback:a.core.func.empty},d);i=a.module.layer(f,e);h=i.getOuter();g=i.getInner();i.setTipWH=function(){c=this.getSize(true);this.tipWidth=c.w;this.tipHeight=c.h;return this};i.setTipWH();i.setContent=function(j){if(typeof j=="string"){g.innerHTML=j}else{g.appendChild(j)}this.setTipWH();return this};i.setLayerXY=function(p){if(!p){throw"ui.tipPrototype need pNode as first parameter to set tip position"}var q=STK.core.dom.position(p);var l=q.l;var o=p.offsetWidth;var k=p.offsetHeight;var n=Math.min(Math.max((l+(o-this.tipWidth)/2),a.scrollPos().left),(a.scrollPos().left+STK.winSize().width)-this.tipWidth);var m=q.t;if(e.direct==="down"){m+=k}var j=[";"];j.push("z-index:",(b++),";");j.push("width:",this.tipWidth,"px;");j.push("height:",this.tipHeight,"px;");j.push("top:",m,"px;");j.push("left:",n,"px;");h.style.cssText+=j.join("")};i.aniShow=function(){var k=this.getOuter();k.style.height="0px";k.style.display="";var j=a.core.ani.tween(k,{end:e.showCallback,duration:250,animationType:"easeoutcubic"});if(e.direct==="down"){j.play({height:this.tipHeight},{staticStyle:"overflow:hidden;position:absolute;"})}else{var l=(parseInt(k.style.top,10)-this.tipHeight);j.play({height:this.tipHeight,top:Math.max(l,a.scrollPos().top)},{staticStyle:"overflow:hidden;position:absolute;"})}};i.anihide=function(){var k=this.getOuter();var m=this;var j=a.core.ani.tween(k,{end:function(){k.style.display="none";k.style.height=m.tipHeight+"px";e.hideCallback()},duration:300,animationType:"easeoutcubic"});if(e.direct==="down"){j.play({height:0},{staticStyle:"overflow:hidden;position:absolute;"})}else{var l=(parseInt(k.style.top,10)+this.tipHeight);j.play({height:0,top:l},{staticStyle:"overflow:hidden;position:absolute;"})}};document.body.appendChild(h);i.destroy=function(){document.body.removeChild(h);i=null};return i}});STK.register("ui.tipAlert",function(a){var b=a.core.util.easyTemplate;return function(c){c=a.parseParam({direct:"up",className:"WB_widgets W_layer",showCallback:a.core.func.empty,hideCallback:a.core.func.empty,template:'<#et temp data><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td><div node-type="msgDiv" class="content layer_mini_info"><p class="clearfix alt_text"><span class="tip_icon WB_tipS_${data.type}"></span>${data.msg}&nbsp; &nbsp; &nbsp; </p></div></td></tr></tbody></table></#et>',type:"ok",msg:""},c);var g=a.ui.tipPrototype(c);var h=g.getInner();var e=g.getOuter();e.className=c.className;h.className="bg";var f=c.template;var i=a.builder(b(f,{type:c.type,msg:c.msg}).toString());g.setContent(i.box);var d=g.destroy;g.destroy=function(){d();g=null};return g}});STK.register("ui.tipConfirm",function(a){return function(j){j=j||{};var g=a.ui.tipPrototype(j);var e=g.getInner();var l=g.getOuter();l.className="WB_widgets W_layer";e.className="bg";j.info=j.info||"确认要删除这条微博吗？";j.icon=j.icon||"icon_ask";var i=j.template||'<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td><div class="content layer_mini_info"><p class="clearfix" node-type="info"><span node-type="icon" class="'+j.icon+'"></span>'+j.info+'</p><p class="btn"><a node-type="ok" class="WB_btngA" href="javascript:void(0)"><span>确定</span></a><a class="WB_btngC" node-type="cancel" href="javascript:void(0)"><span>取消</span></a></p></div></td></tr></tbody></table>';var c=a.builder(i);g.setContent(c.box);if(!c.list.ok){return g}var h=c.list.ok[0];var k=c.list.cancel[0];g.setIcon=function(m){c.list.info.className=m;g.setTipWH()};g.setInfo=function(m){c.list.info[0].innerHTML='<span node-type="icon" class="'+j.icon+'"></span>'+m;g.setTipWH()};g.cancelCallback=function(){if(a.getType(j.cancelCallback)=="function"){j.cancelCallback()}};g.okCallback=function(){if(a.getType(j.okCallback)=="function"){j.okCallback()}};var f=function(){g.anihide();g.cancelCallback()};var b=function(){g.anihide();g.okCallback()};a.addEvent(k,"click",f);a.addEvent(h,"click",b);var d=g.destroy;g.destroy=function(){a.removeEvent(k,"click",f);a.removeEvent(h,"click",b);d();g=null};return g}});STK.register("common.topic.forwardNewPublisher",function(g){var h=g.kit.extra.language;var d=h('<div class="textarea_note"><u class="WB_tipS_ok"></u><cite class="textarea_note_text">#L{发布成功}</cite></div>');var e=h('<div class="textarea_note"><u class="WB_tipS_err"></u><cite class="textarea_note_text">#L{##ERROR##}</cite></div>');var c=h("#L{系统繁忙}");var a={mid:"",srcuid:"",options:{limitNum:140,tipText:h(""),count:"disable",atSwitch:true},oncount:function(){var k=g.trim(this.doms.textEl.value);var j=g.bLength(k);var l=false;var i=Math.floor((this.opts.options.limitNum*2-j)/2);if(this.doms.count){this.doms.count.innerHTML=i;this.doms.count.className=(i>=0)?"weibo_count":"weibo_count S_error"}if(j>this.opts.options.limitNum*2){l=false}else{l=true}this.canPublish=l}};var b;function f(n,m){var l=this;var j;this.node=n;this.opts={};for(var i in a){if(m[i]==null){this.opts[i]=a[i]}else{this.opts[i]=m[i]}}var k=g.common.editor.base(n,this.opts.options);this.editor=k;var o=k.nodeList;this.doms=o;this.smileWidget=g.common.editor.widget.face();k.widget(this.smileWidget,"smileyBtn");g.addEvent(o.forwardBtn,"click",p);g.core.evt.hotKey.add(o.textEl,"ctrl+enter",p);g.addEvent(o.textEl,"focus",function(){j=setInterval(function(){l.opts.oncount.apply(l)},200);o.textEl.value==h("#L{请输入转发理由}")&&(o.textEl.value="")});g.addEvent(o.textEl,"blur",function(){clearInterval(j);g.trim(o.textEl.value)==""&&(o.textEl.value=h("#L{请输入转发理由}"))});function p(){o.textEl.value==h("#L{请输入转发理由}")&&(o.textEl.value="");if(l.canPublish){l.onpublish()}else{g.common.extra.shine(o.textEl)}}k.API.focus()}f.prototype.onpublish=function(){var j=this;if(g.common.topic.delegate.fullinfo()){return}if(g.common.login.getLoginStatus.isLogin()==false){g.common.topic.delegate.login(null,function(){j.onpublish.apply(j,arguments)});return}if(b==true){return}b=true;var k={app_src:$CONFIG.app_src||"",content:this.editor.API.getWords(),mid:this.opts.mid,vsrc:$CONFIG.vsrc||"pk_topic",wsrc:$CONFIG.wsrc||"app_topic_base",url:encodeURIComponent(document.referrer)};if(!!this.doms.is_comment.checked){k.is_comment=1}this.doms.forwardBtn.innerHTML=h('<cite class="WB_gray3_btn_inner"><u class="WB_ico_loadingD"></u>#L{转发中}</cite>');this.doms.forwardBtn.className="submit_btn WB_gray3_btn";var i=g.common.trans.topic.getTrans("repost",{onComplete:function(l){switch(l.code){case"100000":j.doms.textEl.value="";j.canPublish=false;j.doms.forwardBtn.innerHTML=h('<cite class="WB_red_btn_inner">#L{转发}</cite>');j.doms.forwardBtn.className="submit_btn WB_red_btn";j.opts.oncount.apply(j);g.common.channel.feed.fire("forward",[l.data,k]);j.showTips();break;default:j.doms.forwardBtn.innerHTML=h('<cite class="WB_red_btn_inner">#L{转发}</cite>');j.doms.forwardBtn.className="submit_btn WB_red_btn";j.showTips(l.msg);break}b=null},onFail:function(){j.showTips(c);b=null}});i.request(k)};f.prototype.showTips=function(k){var j,i=this;if(k==null){j=d}else{j=e.replace(/##ERROR##/,k)}this.deleteTips();g.core.dom.insertHTML(this.doms.textEl.parentNode,j,"beforeend");this.timer=setTimeout(function(){i.deleteTips();if(k==null){g.common.channel.feed.fire("forward_hide",[i.opts.mid])}clearTimeout(i.timer);i.timer=null},2000)};f.prototype.deleteTips=function(){if(this.timer){clearTimeout(this.timer);this.timer=null}var i=g.core.dom.next(this.doms.textEl);if(i&&g.isNode(i)){g.removeNode(i)}};f.prototype.destroy=function(){g.core.evt.hotKey.remove(this.doms.textEl,"ctrl+enter");g.removeEvent(this.doms.forwardBtn,"click");g.removeEvent(this.doms.textEl,"focus");g.removeEvent(this.doms.textEl,"blur")};return f});STK.register("common.topic.commentNewPublisher",function(g){var h=g.kit.extra.language;var d=h('<div class="textarea_note"><u class="WB_tipS_ok"></u><cite class="textarea_note_text">#L{评论成功}</cite></div>');var e=h('<div class="textarea_note"><u class="WB_tipS_err"></u><cite class="textarea_note_text">#L{##ERROR##}</cite></div>');var c=h("#L{系统繁忙}");var a={mid:"",srcuid:"",options:{limitNum:140,tipText:h(""),count:"disable",atSwitch:true},oncount:function(){var k=g.trim(this.doms.textEl.value);var j=g.bLength(k);var l=false;var i=Math.floor((this.opts.options.limitNum*2-j)/2);if(this.doms.count){this.doms.count.innerHTML=i;this.doms.count.className=(i>=0)?"weibo_count":"weibo_count S_error"}if(j==0||j>this.opts.options.limitNum*2){l=false}else{l=true}this.canPublish=l}};var b;function f(n,m){var l=this;var j;this.node=n;this.opts={};for(var i in a){if(m[i]==null){this.opts[i]=a[i]}else{this.opts[i]=m[i]}}var k=g.common.editor.base(n,this.opts.options);this.editor=k;var o=k.nodeList;this.doms=o;this.canPublish=g.trim(o.textEl.value)==""?false:true;this.smileWidget=g.common.editor.widget.face();k.widget(this.smileWidget,"smileyBtn");g.addEvent(o.commentBtn,"click",p);g.core.evt.hotKey.add(o.textEl,"ctrl+enter",p);g.addEvent(o.textEl,"focus",function(){j=setInterval(function(){l.opts.oncount.apply(l)},200)});g.addEvent(o.textEl,"blur",function(){clearInterval(j)});function p(){if(l.canPublish){l.onpublish()}else{g.common.extra.shine(o.textEl)}}k.API.focus()}f.prototype.onpublish=function(){var j=this;if(g.common.topic.delegate.fullinfo()){return}if(g.common.login.getLoginStatus.isLogin()==false){g.common.topic.delegate.login(null,function(){j.onpublish.apply(j,arguments)});return}if(b==true){return}b=true;var k={app_src:$CONFIG.app_src||"",content:this.editor.API.getWords(),mid:this.opts.mid,is_repost:!!this.doms.is_repost.checked?1:0,vsrc:$CONFIG.vsrc||"pk_topic",wsrc:$CONFIG.wsrc||"app_topic_base",url:encodeURIComponent(document.referrer)};if(j.commentId!=null){k.cid=this.commentId}this.doms.commentBtn.innerHTML=h('<cite class="WB_gray3_btn_inner"><u class="WB_ico_loadingD"></u>#L{评论中}</cite>');this.doms.commentBtn.className="submit_btn WB_gray3_btn";var i=g.common.trans.topic.getTrans("comment",{onComplete:function(l){switch(l.code){case"100000":case"A00006":j.commentId=null;j.doms.textEl.value="";j.canPublish=false;j.doms.commentBtn.className="submit_btn WB_red_btn";j.doms.commentBtn.innerHTML=h('<cite class="WB_red_btn_inner">#L{评论}</cite>');j.opts.oncount.apply(j);g.common.channel.feed.fire("comment",[l.data,k]);j.showTips();break;default:j.doms.commentBtn.className="submit_btn WB_red_btn";j.doms.commentBtn.innerHTML=h('<cite class="WB_red_btn_inner">#L{评论}</cite>');j.showTips(l.msg);break}b=null},onFail:function(){j.showTips(c);b=null}});i.request(k)};f.prototype.setCid=function(i){this.commentId=i};f.prototype.showTips=function(k){var j,i=this;if(k==null){j=d}else{j=e.replace(/##ERROR##/,k)}this.deleteTips();g.core.dom.insertHTML(this.doms.textEl.parentNode,j,"beforeend");this.timer=setTimeout(function(){i.deleteTips();if(k==null){g.common.channel.feed.fire("comment_hide",[i.opts.mid])}clearTimeout(i.timer);i.timer=null},2000)};f.prototype.deleteTips=function(){if(this.timer){clearTimeout(this.timer);this.timer=null}var i=g.core.dom.next(this.doms.textEl);if(i&&g.isNode(i)){g.removeNode(i)}};f.prototype.destroy=function(){this.commentId=null;g.core.evt.hotKey.remove(this.doms.textEl,"ctrl+enter");g.removeEvent(this.doms.commentBtn,"click");g.removeEvent(this.doms.textEl,"focus");g.removeEvent(this.doms.textEl,"blur")};return f});STK.register("common.topic.feedManage",function(f){var z=f.kit.extra.language;var s;var t,x,j,v;var p={},o={},q={};var d,w=null,e,m;var y=z('<div class="weibo_feed_info"><div class="loading_status_container"><u class="WB_tipB_warn"></u></div><div class="status_note">#L{还没有人发表过相关微博，赶快抢沙发吧!}</div></div>');var g=z('<div class="weibo_feed_info"><div class="loading_status_container"><u class="WB_tipB_warn"></u></div><div class="status_note">#L{数据查询失败，请}<a href="#" onclick="return false;" action-type="reload">#L{重试}</a></div></div>');var c=z('<div class="weibo_feed_info"><div class="loading_status_container"><u class="WB_tipB_warn"></u></div><div class="status_note">#L{你还没登录哦，请先}<a href="#" onclick="return false;" action-type="login">#L{登录}</a>#L{后查看}</div></div>');var i={login:c,error:g};var l=z('<div class="handle_expand S_border S_bg_ex" node-type="forward"><div class="expand_arrow" style="right:80px;"><cite class="expand_arrow_border S_border_c">◆</cite><cite class="expand_arrow_content S_bg_ex_c">◆</cite></div><div class="expand_container"><div class="input_container" node-type="publisher"><div class="expand_textarea_container"><textarea class="expand_textarea" node-type="textEl"></textarea></div><div class="input_submit"><div class="input_media" node-type="widget"><a href="#" onclick="return false;" class="media_link" node-type="smileyBtn" title=""><u class="WB_ico_face"></u></a><label class="input_form_plus"><input type="checkbox" class="WB_checkbox2" node-type="is_comment">#L{同时评论}</label></div><div class="submit_btn_container"><cite class="weibo_count" node-type="count">140</cite><a href="#" onclick="return false;" node-type="forwardBtn" class="submit_btn WB_red_btn" title=""><cite class="WB_red_btn_inner">#L{转发}</cite></a></div></div></div>#######</div></div>');var n=z('<div class="handle_expand S_border S_bg_ex" node-type="comment"><div class="expand_arrow" style="right:0;"><cite class="expand_arrow_border S_border_c">◆</cite><cite class="expand_arrow_content S_bg_ex_c">◆</cite></div><div class="expand_container"><div class="input_container" node-type="publisher"><div class="expand_textarea_container"><textarea class="expand_textarea" node-type="textEl"></textarea></div><div class="input_submit"><div class="input_media" node-type="widget"><a href="#" onclick="return false;" class="media_link" node-type="smileyBtn" title=""><u class="WB_ico_face"></u></a><label class="input_form_plus"><input type="checkbox" class="WB_checkbox2" node-type="is_repost" checked="checked" />#L{同时转发}</label></div><div class="submit_btn_container"><cite class="weibo_count" node-type="count">140</cite><a href="#" onclick="return false;" node-type="commentBtn" class="submit_btn WB_red_btn" title=""><cite class="WB_red_btn_inner">#L{评论}</cite></a></div></div></div>#######</div></div>');var a=z('<ul class="layer_handle_list"><li class="layer_handle_item"><a class="layer_handle_link" href="javascript:;" action-type="blockMid">#L{屏蔽这条微博}</a></li><li class="layer_handle_item"><a class="layer_handle_link" href="javascript:;" action-type="blockUid">#L{禁言这个用户}</a></li></ul>');var u=z('<ul class="layer_handle_list"><li class="layer_handle_item"><a class="layer_handle_link" href="javascript:;" action-type="allowMid">#L{解除屏蔽}</a></li></ul>');var h=z('<ul class="layer_handle_list"><li class="layer_handle_item"><a class="layer_handle_link" href="javascript:;" action-type="allowUid">#L{解除禁言}</a></li></ul>');var k=z("#L{确认要取消收藏这条微博吗？}");var b=z("#L{回复}");var r={setFeedListHTML:function(A){if(x.error_node){x.error_node.style.display="none"}if(A.top_feed){x.top_feed.style.display=""}x.scroll_list.innerHTML=A.html;x.feedlist.style.display="";x.scroll_list.scrollTop=0},closeTopTopic:function(A){var B=f.kit.dom.parentElementBy(A.el,document.body,function(C){if(C.getAttribute("node-type")=="top_feed"){return true}});if(B!=null){B.style.display="none"}},setFakeHTML:function(B){var A=f.sizzle("ul",x.scroll_list);if(A.length>0){A=A[0];f.insertHTML(A,B,"afterbegin")}else{x.scroll_list.innerHTML="<ul>"+B+"</ul>"}},setFailHTML:function(A){var C=i[A];if(C==null){C=i.error}if(x.error_node==null){f.addHTML(t,'<div node-type="error_node">'+C+"</div>");var B=f.sizzle('div[node-type="error_node"]',t);if(B.length>0){x.error_node=B[0]}}else{x.error_node.innerHTML=C}x.error_node.style.display="";x.feedlist.style.display="none"},reloadTopic:function(){f.core.evt.custEvent.fire(j.custKeyReload,"reload",[])},preview:function(B){if(B.el){var C=B.el,A=C.src;if(C.className=="WB_big_cursor"){C.src=A.replace("thumbnail","bmiddle");C.className="WB_small_cursor"}else{C.src=A.replace("bmiddle","thumbnail");C.className="WB_big_cursor"}}},onscroll:function(){var A=x.scroll_list;if(A.scrollTop+A.clientHeight==A.scrollHeight){f.core.evt.custEvent.fire(j.custKeyReload,"autoload",[])}},forward:function(A){var B=A.data.mid,C=A.el;if(p[B]!=null&&p[B].allowForward!=null){if(p[B].allowForward==1){if(C.getAttribute("open")!=1){r.getFeedInfo(A,r.initForwardPublisher,"forward");C.setAttribute("open",1);r.hideComment(A)}else{C.setAttribute("open",null);r.hideForward(A)}}else{r.showBubble(z("#L{由于作者隐私设置，你没有权限转发此微博。}"),A.el,true)}}else{r.getMidInfo(B,function(){r.forward(A)})}},comment:function(A){var B=A.data.mid,C=A.el;if(p[B]!=null&&p[B].allowComment!=null){if(p[B].allowComment==1){if(C.getAttribute("open")!=1){r.getFeedInfo(A,r.initCommentPublisher,"comment");C.setAttribute("open",1);r.hideForward(A)}else{C.setAttribute("open",null);r.hideComment(A)}}else{r.showBubble(z("#L{由于作者隐私设置，你没有权限评论此微博。}"),A.el,true)}}else{r.getMidInfo(B,function(){r.comment(A)})}},hideComment:function(A){var B=A.data.mid,D=A.el,C;while(D.getAttribute("action-type")!="comment"){D=f.core.dom.next(D)}D.setAttribute("open",null);var E=r.getContainer(D);var F=f.sizzle('[node-type="comment"]',E);if(F.length>0){F[0].style.display="none"}r.hideSmileLayer()},hideForward:function(A){var C=A.data.mid,E=A.el,D;while(E.getAttribute("action-type")!="forward"){E=f.core.dom.prev(E)}E.setAttribute("open",null);var F=r.getContainer(E);var B=f.sizzle('[node-type="forward"]',F);if(B.length>0){B[0].style.display="none"}r.hideSmileLayer()},reply:function(C,G){var D=C.data.mid,F=C.el;var B=f.sizzle('a[class="user_name"]',F.parentNode.parentNode),A,E;if(B.length>0){A=B[0].title;switch(G){case"forward":E=o[D].editor.API;break;case"comment":q[D].setCid(C.data.cid);E=q[D].editor.API;break}E.reset();E.insertText(b+A+":")}},getFeedInfo:function(B,F,D){if(v==true){return}if(f.common.login.getLoginStatus.isLogin()==false){f.common.topic.login.login();return}if(f.common.topic.login.fullinfo()==false){return}var C=B.data.mid;var E={wsrc:$CONFIG.wsrc||"app_topic_base",app_src:$CONFIG.default_app_src,mid:C,count:2,language:$CONFIG.language,output:2};v=true;var A=f.common.trans.topic.getTrans((D=="forward"?"get_forward":"get_comment"),{onComplete:function(G){switch(G.code){case"100000":F&&F(G.data,B);break;default:F&&F(null,B);break}v=null},onFail:function(){F&&F(null,B);v=null}});A.request(E)},initForwardPublisher:function(E,K){var J=K.data.mid,B=K.el,F;var C=r.getContainer(B);var G=f.sizzle('[node-type="forward"]',C);F=l.replace("#######",E);F=F.replace("right:80px;","right:"+Math.max(B.parentNode.offsetWidth-24,0)+"px");if(G.length==0){f.addHTML(C,F);G=f.sizzle('[node-type="forward"]',C)[0];var I=f.kit.dom.parseDOM(f.builder(G).list);o[J]=new f.common.topic.forwardNewPublisher(I.publisher,{mid:J||"",srcuid:K.data.srcuid||""});d=o[J].smileWidget}else{G=G[0];G.style.display="";var L=f.sizzle('[node-type="textEl"]',G)[0];L.value="";var A=f.sizzle('[node-type="forwardBtn"]',G)[0];A.className="submit_btn WB_red_btn";A.innerHTML=z('<cite class="WB_red_btn_inner">#L{转发}</cite>');var H=f.sizzle('[node-type="count"]',G)[0];H.className="weibo_count";H.innerHTML="140";var D=f.sizzle('[node-type="is_comment"]',G)[0];D.checked=false;o[J].canPublish=false}},initCommentPublisher:function(D,K){var J=K.data.mid,A=K.el,E;var B=r.getContainer(A);var F=f.sizzle('[node-type="comment"]',B);E=n.replace("#######",D);E=E.replace("right:0;","right:"+Math.max(A.offsetWidth-24,0)+"px");if(F.length==0){f.addHTML(B,E);F=f.sizzle('[node-type="comment"]',B)[0];var H=f.kit.dom.parseDOM(f.builder(F).list);q[J]=new f.common.topic.commentNewPublisher(H.publisher,{mid:K.data.mid||"",srcuid:K.data.srcuid||"",name:K.data.cid||"",cid:K.data.name||""});d=q[J].smileWidget}else{F=F[0];F.style.display="";var L=f.sizzle('[node-type="textEl"]',F)[0];L.value="";var I=f.sizzle('[node-type="commentBtn"]',F)[0];I.className="submit_btn WB_red_btn";I.innerHTML=z('<cite class="WB_red_btn_inner">#L{评论}</cite>');var G=f.sizzle('[node-type="count"]',F)[0];G.className="weibo_count";G.innerHTML="140";var C=f.sizzle('[node-type="is_repost"]',F)[0];C.checked=true;q[J].canPublish=false}},getContainer:function(A){var B=f.kit.dom.parentElementBy(A,document.body,function(C){if(C.className=="feed_item S_separate_l"||C.className=="top_weibo_item"||C.className=="feed_item S_separate_l feed_item_forbidden"){return true}});return B},getMidInfo:function(B,D){if(v==true){return}if(f.common.login.getLoginStatus.isLogin()==false){f.common.topic.login.login();return}if(f.common.topic.login.fullinfo()==false){return}var C={wsrc:$CONFIG.wsrc||"app_topic_base",appkey:$CONFIG.appkey,action:"",mid:B};v=true;var A=f.common.trans.topic.getTrans("check",{onComplete:function(E){v=null;switch(E.code){case"100000":p[B]=E.data;D&&D();break;default:p[B]={allowForward:0,allowComment:0};D&&D();break}},onFail:function(){v=null;p[B]={allowForward:0,allowComment:0};D&&D()}});A.request(C)},favorite:function(B,E){var C=this;if(f.common.login.getLoginStatus.isLogin()==false){f.common.topic.login.login();return}if(f.common.topic.login.fullinfo()==false){return}if(v==true){return}v=true;var D={wsrc:$CONFIG.wsrc||"app_topic_base",app_src:$CONFIG.default_app_src||"",mid:B.data.mid};var A=f.common.trans.topic.getTrans("addfav",{onComplete:function(F){var G;switch(F.code){case"100000":if(E!=null&&typeof E=="function"){E(F.data)}else{B.el.innerHTML=z("#L{取消收藏}");B.el.setAttribute("action-type","unfavorite");r.showBubble(z("#L{收藏成功}"),B.el)}break;default:r.showBubble(F.msg,B.el,true);break}v=null},onFail:function(){r.showBubble(SYSTEM_BUSY,B.el,true);v=null}});A.request(D)},unfavorite:function(A,D){if(v==true){return}v=true;var C=this;var B=f.ui.tipConfirm({info:k,icon:"tip_icon WB_tipS_ques",okCallback:function(){var F={wsrc:$CONFIG.wsrc||"app_topic_base",app_src:$CONFIG.default_app_src||"",mid:A.data.mid};var E=f.common.trans.topic.getTrans("delfav",{onComplete:function(G){var H;switch(G.code){case"100000":if(D!=null&&typeof D=="function"){D(G.data)}else{A.el.innerHTML=z("#L{收藏}");A.el.setAttribute("action-type","favorite");r.showBubble(z("#L{取消收藏成功}"),A.el)}break;default:r.showBubble(G.msg,A.el,true);break}v=null},onFail:function(){r.showBubble(SYSTEM_BUSY,A.el,true);v=null}});E.request(F)},hideCallback:function(){v=null},template:z('<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td><div class="content layer_mini_info"><div class="clearfix" node-type="info"><cite class="tip_icon WB_tipS_ques"></cite>'+k+'</div><div class="btn"><a node-type="ok" class="WB_orange_btn" href="#" onclick="return false;"><cite class="WB_orange_btn_inner">#L{确定}</cite></a><a class="WB_gray5_btn" node-type="cancel" href="#" onclick="return false;"><cite class="WB_gray5_btn_inner">#L{取消}</cite></a></div></div></td></tr></tbody></table>')});B.setLayerXY(A.el);B.aniShow()},showBubble:function(E,C,B){var D=this;var A=f.ui.tipAlert({showCallback:function(){setTimeout(function(){A&&A.anihide()},600)},hideCallback:function(){tipOnMid=undefined;A&&A.destroy();A=null},msg:E,type:B?"err":"ok",template:'<#et temp data><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td><div class="content layer_mini_info"><div class="clearfix"><span class="tip_icon WB_tipS_${data.type}"></span>${data.msg}</div></div></td></tr></tbody></table></#et>'});A.setLayerXY(C);A.aniShow()},hideSmileLayer:function(){if(d&&typeof d.hide=="function"){d.hide()}if(f.E("admin_menu")){f.E("admin_menu").style.display="none"}},adminShow:function(A){A=f.fixEvent(A);var C=A.target;while(C.className!="feed_item S_separate_l feed_item_forbidden"&&C.className!="feed_item S_separate_l"&&C!=x.scroll_list){C=C.parentNode}if(C.className=="feed_item S_separate_l feed_item_forbidden"||C.className=="feed_item S_separate_l"){var B=0;while(C.childNodes[B].className!="admin_feed_handle"){B++}C.childNodes[B].style.display="block";if(w&&w!=C.childNodes[B]){w.style.display="none";f.E("admin_menu").style.display="none"}w=C.childNodes[B]}else{w&&(w.style.display="block")}},adminHide:function(A){A=f.fixEvent(A);var B=A.target;if(B.className!="layer_handle_link"&&B.className!="admin_feed_handle_link"){f.E("admin_menu").style.display="none"}},block:function(A){var C=f.core.dom.position(A.el);var D=f.E("admin_menu"),B;console.log(A.data.is_block);switch(A.data.is_block){case"1":D.innerHTML=u;B=C.l-63;break;case"2":D.innerHTML=h;B=C.l-63;break;default:D.innerHTML=a;B=C.l-83}if(D.style.display=="none"){D.style.display="block"}else{D.style.display="none"}f.core.dom.setXY(D,{t:C.t+11,l:B});e=A.data.mid;m=A.data.uid},blockAjax:function(B){var A=f.common.trans.topic.getTrans("block",{onComplete:function(C){switch(C.code){case"100000":default:r.reloadTopic();f.E("admin_menu").style.display="none"}},onFail:function(){r.reloadTopic();f.E("admin_menu").style.display="none"}});A.request(B)},blockMid:function(A){var B={app_src:$CONFIG.app_src,block_key:$CONFIG.block_key,block_id:e,blockid_type:1,is_del:0};r.blockAjax(B)},blockUid:function(A){var B={app_src:$CONFIG.app_src,block_key:$CONFIG.block_key,block_id:m,blockid_type:2,is_del:0};r.blockAjax(B)},allowMid:function(A){var B={app_src:$CONFIG.app_src,block_key:$CONFIG.block_key,block_id:e,blockid_type:1,is_del:1};r.blockAjax(B)},allowUid:function(A){var B={app_src:$CONFIG.app_src,block_key:$CONFIG.block_key,block_id:m,blockid_type:2,is_del:1};r.blockAjax(B)}};return function(A){t=A;x=f.kit.dom.parseDOM(f.builder(A).list);s=f.core.evt.delegatedEvent(A);s.add("close","click",r.closeTopTopic);s.add("reload","click",r.reloadTopic);s.add("forward","click",function(B){r.forward(B)});s.add("forward_reply","click",function(B){r.reply(B,"forward")});s.add("favorite","click",function(B){r.favorite(B)});s.add("unfavorite","click",function(B){r.unfavorite(B)});s.add("comment","click",function(B){r.comment(B)});s.add("comment_reply","click",function(B){r.reply(B,"comment")});s.add("preview","click",r.preview);s.add("login","click",function(){f.common.topic.login.login()});f.addEvent(x.scroll_list,"scroll",function(){r.hideSmileLayer()});if($CONFIG.is_admin=="1"){f.addEvent(x.scroll_list,"mouseover",r.adminShow);f.addEvent(document.body,"click",r.adminHide);s.add("block","click",r.block);s.add("blockMid","click",r.blockMid);s.add("blockUid","click",r.blockUid);s.add("allowMid","click",r.allowMid);s.add("allowUid","click",r.allowUid)}j={setFeedListHTML:r.setFeedListHTML,setFakeHTML:r.setFakeHTML,setFailHTML:r.setFailHTML};j.custKeyReload=f.core.evt.custEvent.define(j,"reload");j.custKeyReload=f.core.evt.custEvent.define(j,"count");j.custKeyReload=f.core.evt.custEvent.define(j,"autoload");return j}});STK.register("common.channel.topic",function(b){var a=["publish","forward","forward_hide","comment","comment_hide","reload","vote","topic_change"];return b.common.listener.define("common.channel.topic",a)});STK.register("comp.topic.viewpoint",function(a){var b=a.kit.extra.language;return function(g,c){var m={};var f,h,j=$CONFIG.tag;var k={};var q={};var n={reloadTopic:function(t){f.setTopic(t)},writeToList:function(t){h.setFakeHTML(t)}};var s=function(){o();e();i();l();d();p()};var o=function(){if(g==null||(g!=null&&!a.core.dom.isNode(g))){throw"[comp.topic.viewpoint]:argsCheck()-The param node is not a DOM node."}c=a.core.obj.parseParam({html:""},c)};var e=function(){};var i=function(){f=a.common.topic.feedFilter(g,j);h=a.common.topic.feedManage(g)};var l=function(){};var d=function(){a.custEvent.add(f,"success",function(u,t){h.setFeedListHTML(t)});a.custEvent.add(f,"failure",function(){h.setFailHTML("error")});a.custEvent.add(f,"needlogin",function(){h.setFailHTML("login")});a.custEvent.add(h,"count",function(){});a.custEvent.add(h,"reload",function(){f.reload()});a.custEvent.add(h,"autoload",function(){f.autoload()})};var p=function(){a.common.channel.topic.register("topic_change",function(t){if(t!=null){t=t.replace(/#/g,"")}n.reloadTopic(t)});a.common.channel.topic.register("publish",n.writeToList)};var r=function(){};s();m.destroy=r;return m}});STK.pageletM.register("pl.topic.viewpoint",function(d){var c={};var b=d.E("pl_topic_viewpoint");var a=d.comp.topic.viewpoint(b,c);return a});STK.register("core.obj.parseParam",function(a){return function(d,c,b){var e,f={};c=c||{};for(e in d){f[e]=d[e];if(c[e]!=null){if(b){if(d.hasOwnProperty[e]){f[e]=c[e]}}else{f[e]=c[e]}}}return f}});STK.register("common.widget.log",function(b){var a={app_sharebutton:1,app_followbutton:2,app_livestream:4,app_listweibo:5,app_weiboshow:6,app_commentbox:7};return function(i){var e=b.core.obj.parseParam({vsrc:"app_weiboshow",refer:"",step:1},i);var g=scope.refer||scope.$refer||e.refer,f=scope.loginKit().uid||"",h=(scope.appkey||$CONFIG.$appkey||$CONFIG.appkey||0),c=a[e.vsrc]||"";var j="//rs.sinajs.cn/r.gif?uid="+f+"&appid="+h+"&refer="+g+"&cat="+c+"&step="+e.step+"&rnd="+(+new Date());var d=new Image();d.src=j;d=null}});STK.register("common.widget.login",function(b){var a={vsrc:"app_weiboshow",appsrc:"",showlogo:0,callback:function(){}};if(typeof App==="undefined"){App={}}return function(f){f=b.parseParam(a,f);if(!f.appsrc){f.appsrc=scope?(scope.appsrc?scope.appsrc:(scope.$appsrc?scope.$appsrc:"")):""}var e={};App.loginBackUrlCallBack=function(j){b.custEvent.fire(e,"login",j);f.step=2;b.common.widget.log(f)};var i=function(){g();c();h();d()};var g=function(){};var c=function(){};var h=function(){b.custEvent.define(e,"login")};var d=function(){b.custEvent.add(e,"login",function(j){f.callback(j)})};e.showLogin=function(){var m="&"+b.jsonToQuery(f);var l=navigator.userAgent.indexOf("360 Aphone Browser")>=0;var n=/micromessenger\/(\d+\.\d+\.\d+)/i.test(navigator.userAgent);if(l||n){location.href="http://service.weibo.com/reg/loginindex.php?regbackurl=http%3A%2F%2Fweibo.com&backurl="+encodeURIComponent(location.href)+m+"&rnd="+(+new Date().valueOf());return}var k="http://service.weibo.com/reg/loginindex.php?regbackurl=http%3A%2F%2Fweibo.com&backurl=http%3A%2F%2F"+location.host+"%2Fstaticjs%2FloginProxy.html"+m+"&rnd="+(+new Date().valueOf());if(/weibo.com/.test(location.host)){k=k.replace(/\/widget/,"")}var j=window.open(k,"miniblog_login",["toolbar=1,status=0,resizable=1,width=620,height=540,left=",(screen.width-620)/2,",top=",(screen.height-450)/2].join(""));j.focus();b.common.widget.log(f)};i();return e}});STK.register("common.widget.reg",function(c){var a=c.kit.extra.language;var b=c.ui.tipAlert({className:"WB_tips_top",showCallback:function(){var d=b.getOuter();d.style.height="";d=null},template:'<#et temp data><div class="tips_inner"><span class="WB_tipS_warn"></span><span class="WB_icon_txt">'+a("#L{您的帐号尚未开通微博，}")+'<a href="http://weibo.com/signup/full_info.php?appsrc=6cm7D0&backurl='+encodeURIComponent(document.URL)+'&showlogo=0&vsrc=weiboshow&from=zw" target="_blank">'+a("#L{立即开通}")+"</a></span></#et>"});return function(d){if(!c.isNode(d)){throw"[common.widget.reg] need node as first parameter"}b.setLayerXY(d);b.aniShow();return b}});STK.register("common.widget.addFollowBtn",function(d){var c=d.kit.extra.language;var b=function(){},a={uid:scope.loginKit().uid,url:"",fuid:"",vsrc:"",success:b,fail:b,followed:"",self:"",followfail:"",followedClass:"",ext:"",app_src:""};var e=function(g,f){if(f.fuid===f.uid){if(f.self){g.innerHTML=f.self?c(f.self):c("#L{你自己}");g.className=f.followedClass?f.followedClass:g.className}return"yourself"}if(!f.url){f.url="/public/aj_attention.php"}d.ajax({method:"post",url:f.url,args:{ext:f.ext?f.ext:"",fid:f.fuid,refer:encodeURIComponent(document.location.href),vsrc:f.vsrc,url:document.referrer?encodeURIComponent(document.referrer):encodeURIComponent(document.location.href),app_src:f.app_src},onComplete:function(i){switch(i.code){case"A00006":break;case"A10007":break;case"A10008":break;case -1:d.common.widget.reg(g);break;case -2:var h=d.common.widget.login();d.custEvent.add(h,"login",function(){f.uid=scope.loginKit().uid;e(f)});h.showLogin();break;case -3:break}if((i.code=="A00006"||i.code=="A10007"||i.code=="A10008")&&g){g.innerHTML=f.followed?c(f.followed):c("#L{已关注}");g.className=f.followedClass?f.followedClass:g.className;typeof f.success==="function"&&f.success(i)}else{g.innerHTML=f.followfail?c(f.followfail):c("#L{请重试}");typeof f.fail==="function"&&f.fail()}},onFail:function(){g.innerHTML=f.followfail?c(f.followfail):c("#L{请重试}");typeof f.fail==="function"&&f.fail()}})};return function(k,j){if(!k){throw"[common.widget.addFollowBtn] need node as parameter";return}var g=function(){if(parent!=self&&parent!=parent.parent){return}if(d.common.login.getLoginStatus.isLogin()==false){d.common.topic.login.login();return}if(d.common.topic.login.fullinfo()==false){return}if(!scope.$isLogin()){var m=d.common.widget.login();d.custEvent.add(m,"login",function(){j.uid=scope.loginKit().uid;e(this,j)});m.showLogin();return}e(this,j)};var i={};var l=function(){j=d.parseParam(a,j);if(!j.fuid){j.fuid=k.getAttribute("uid")}f()};var f=function(){d.addEvent(k,"click",g)};var h=function(m){d.removeEvent(m,"click",g)};i.destroy=h;l();return i}});STK.register("comp.topic.sidebar",function(e){var c=e.core.ani.tween;var f=e.kit.extra.language;var d=f("#L{已关注}");var a=f("#L{你自己}");var b=f("#L{请重试}");return function(w,t){var o={};var H,D,l,G,i,C,q,z;var E=false,m=false;function k(L,K,J){switch(J){case"show":c(L,{end:function(){K.className="relay_withdraw_btn";L.className="related_item S_separate_r";L.setAttribute("style","");i=L;C=K}}).finish({height:L.scrollHeight-15});return;case"hide":c(L,{end:function(){K.className="relay_expand_btn";L.className="related_item related_item_fold S_separate_r";L.setAttribute("style","")}}).finish({height:45});return;default:}}function s(L){var K=e.E("cardMain");var J=e.common.trans.topic.getTrans("getcard",{onComplete:function(M){switch(M.code){case"100000":K.innerHTML=M.data;var N=e.core.dom.sizzle(".follow_status_btn",K);if(N.length>0){N=N[0];N.style.display="none"}u();break;default:break}},onFail:function(){K.innerHTML=f("#L{获取名片失败}")}});K&&J.request(L)}function x(){var J='<div class="WB_widget usercard_layer" style="display:none;top:9999px;left:9999px;" id="usercard"><div class="usercard_layer_outside"><div class="usercard_layer_inside" id="cardMain"></div><div class="layer_arrow_inside_b"></div></div><div class="layer_arrow_outside_b"></div></div>';e.insertHTML(document.body,J,"beforeend");l=e.E("usercard");l&&e.addEvent(l,"mouseover",g.keepCarte);l&&e.addEvent(l,"mouseout",g.timeoutCarte)}function u(){l.style.display=l&&"block";E=false}function I(){if(E){l.style.display="none"}}var g={showCarte:function(M){if(e.common.login.getLoginStatus.isLogin()==false){return}if(e.common.topic.login.fullinfo(false)==false){return}var J=e.fixEvent(M);if((J.target.className==="user_avatar"||J.target.className==="personal_name")&&l){var O=e.core.dom.position(J.target);var K=e.core.dom.getSize(J.target);var L=e.core.dom.getSize(l);l.style.left=O.l-L.width+K.width+"px";l.style.top=O.t+K.height+8+"px";if(!m){var N={wsrc:$CONFIG.wsrc||"app_topic_base",fuid:$CONFIG.fuid,language:$CONFIG.language};s(N);m=true}else{u()}}},hideCarte:function(K){var J=e.fixEvent(K);if(J.target.className==="user_avatar"||J.target.className==="personal_name"){g.timeoutCarte()}},relaySwitchBtn:function(J){if(J.el!==i){k(i,C,"hide")}k(J.el.parentNode,J.el,J.el.className==="relay_withdraw_btn"?"hide":"show")},keepCarte:function(){E=false},timeoutCarte:function(){E=true;setTimeout(I,1000)}};var A={};var r={weekrank:function(K){var L={tag:K,app_src:$CONFIG.app_src,language:$CONFIG.language,is_base:($CONFIG.vsrc=="base_topic"?1:0),block_key:$CONFIG.block_key||""};var J=e.common.trans.topic.getTrans("getweekrank",{onComplete:function(M){switch(M.code){case"100000":H.weekrank&&(H.weekrank.innerHTML=M.data.html);C=e.core.dom.sizzle('[action-type="relaySwitchBtn"]',w);if(C.length>0){C=C[0];i=C.parentNode}break;default:break}},onFail:function(){}});J.request(L)}};var y=function(){v();h();B();j();n();p()};var v=function(){if(w==null||(w!=null&&!e.core.dom.isNode(w))){throw"[comp.topic.sidebar]:argsCheck()-The param node is not a DOM node."}t=e.core.obj.parseParam({html:""},t)};var h=function(){H=e.builder(w).list;H=e.kit.dom.parseDOM(H)};var B=function(){C=e.core.dom.sizzle('[action-type="relaySwitchBtn"]',w);if(C.length>0){C=C[0];i=C.parentNode}if(H.followBtn){q=new e.common.widget.addFollowBtn(H.followBtn,{fuid:$CONFIG.fuid,wsrc:$CONFIG.wsrc||"app_topic_base",vsrc:$CONFIG.vsrc,followed:'<cite class="WB_follow_status_inner"><cite class="WB_follow_box"><u class="WB_icon_followed"></u>'+d+"</cite></cite>",self:'<cite class="WB_follow_status_inner"><cite class="WB_follow_box"><u class="WB_icon_followed"></u>'+a+"</cite></cite>",followfail:'<cite class="WB_orange_btn_inner">'+b+"</cite>",followedClass:"WB_gray_btn",success:function(){q.destroy(H.followBtn)}})}x()};var j=function(){D=e.core.evt.delegatedEvent(w);D.add("relaySwitchBtn","click",g.relaySwitchBtn);e.addEvent(H.sidebar_carte,"mouseover",g.showCarte);e.addEvent(H.sidebar_carte,"mouseout",g.hideCarte)};var n=function(){};var p=function(){e.common.channel.topic.register("topic_change",function(J){if(J!=null){J=J.replace(/#/g,"")}r.weekrank(J)})};var F=function(){D.remove("relaySwitchBtn","click",g.relaySwitchBtn);e.removeEvent(H.sidebar_carte,"mouseover",g.showCarte);e.removeEvent(H.sidebar_carte,"mouseout",g.hideCarte)};y();o.destroy=F;return o}});STK.pageletM.register("pl.topic.sidebar",function(d){var c={};var b=d.E("pl_topic_sidebar");var a=d.comp.topic.sidebar(b,c);return a});STK.pageletM.start();